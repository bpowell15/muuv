(function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.Action=function(o){function e(t){this.athlete_id=t,this.selector="ul.following.athletes > li",e.__super__.constructor.call(this)}return t(e,o),e.prototype.setController=function(t){return this.controller=t},e.prototype.use_selector=function(t){return this.selector=t},e.prototype.enter=function(){},e.prototype.execute=function(){},e.prototype.handleSuccessExit=function(t){var o;return o=jQuery(this.selector+"[data-athlete-id='"+this.athlete_id+"']").find("a.primary[data-follow]"),o.attr("data-follow",t).removeClass("disabled").removeClass("current-action")},e}(Backbone.View)}).call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.AcceptAction=function(o){function e(t){e.__super__.constructor.call(this,t)}return t(e,o),e.prototype.execute=function(t){return this.controller.acceptFollow(t.data("follow")),this.hideRow(t)},e.prototype.hideRow=function(t){var o,e;return e=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),o=e.find(".h4 a").text(),e.fadeOut("fast",function(){return e.empty().addClass("centered").text(Strava.I18n.Locale.t("templates.follows.accept_action",{name:o})),e.addClass("action-success").fadeIn("fast").animate({"min-height":0},"fast")})},e}(Strava.Follows.Action)}.call(this),function(){Strava.module("Strava.Follows"),Strava.Follows.Factory=function(){function t(){}return t.controller=null,t.createAction=function(t,o){switch(t){case"follow_with_approval":return this.createFollowWithApprovalAction(o);case"follow":return this.createFollowAction(o);case"unfollow_for_approval":return this.createUnfollowForApprovalAction(o);case"unfollow":return this.createUnfollowAction(o);case"cancel_pending":return this.createPendingApprovalAction(o);case"accept":return this.createAcceptAction(o);case"ignore":return this.createIgnoreAction(o)}},t.createActionFromClass=function(t,o){var e;return e=new t(o),e.setController(this.controller),e},t.createFollowAction=function(t){return this.createActionFromClass(Strava.Follows.FollowAction,t)},t.createFollowWithApprovalAction=function(t){return this.createActionFromClass(Strava.Follows.FollowWithApprovalAction,t)},t.createUnfollowForApprovalAction=function(t){return this.createActionFromClass(Strava.Follows.UnfollowForApprovalAction,t)},t.createUnfollowAction=function(t){return this.createActionFromClass(Strava.Follows.UnfollowAction,t)},t.createPendingApprovalAction=function(t){return this.createActionFromClass(Strava.Follows.PendingApprovalAction,t)},t.createAcceptAction=function(t){return this.createActionFromClass(Strava.Follows.AcceptAction,t)},t.createIgnoreAction=function(t){return this.createActionFromClass(Strava.Follows.IgnoreAction,t)},t}()}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.FollowAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#follow_button")}return t(e,o),e.prototype.execute=function(t){var o,e;return e=function(t){return function(o){return t.handleSuccessExit(o)}}(this),this.controller.follow(this.athlete_id,e),o=Strava.Follows.Factory.createUnfollowAction(this.athlete_id),o.enter(t)},e.prototype.enter=function(t){return t.replaceWith(this.template({}))},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.FollowWithApprovalAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#follow_with_approval_button")}return t(e,o),e.prototype.execute=function(t){var o,e;return e=function(t){return function(o){return t.handleSuccessExit(o)}}(this),this.controller.requestFollow(this.athlete_id,e),o=Strava.Follows.Factory.createPendingApprovalAction(this.athlete_id),o.enter(t)},e.prototype.enter=function(t){var o;return o=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),o.length&&0===o.find("div.sprite.lock").length&&t.before('<span class="app-icon-wrapper sprite lock"><span class="app-icon icon-private icon-dark"></span></span>'),t.replaceWith(this.template({}))},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.FollowsController=function(o){function e(t,o,n){this.url=t,this.followerId=o,this.stmSource="stm-source-"+n,e.__super__.constructor.call(this)}return t(e,o),e.prototype.follow=function(t,o){var e;return null==o&&(o=function(){}),e={stm_source:this.stmSource,follow:{following_id:t,follower_id:this.followerId}},this.save(null,{url:this.url,type:"POST",data:JSON.stringify(e),contentType:"application/json",success:function(t,e){return o(e.follow_id)}})},e.prototype.unFollow=function(t){return this.fetch({url:this.urlWithStmSource(this.url+"/"+t),type:"DELETE"})},e.prototype.removeFollow=function(t){return this.fetch({url:this.urlWithStmSource(this.url+"/"+t),type:"DELETE",cache:!1})},e.prototype.requestFollow=function(t,o){return this.follow(t,o)},e.prototype.acceptFollow=function(t){return this.fetch({url:this.urlWithStmSource(this.url+"/"+t+"/accept"),type:"POST",cache:!1})},e.prototype.cancelRequest=function(t){return this.unFollow(t)},e.prototype.ignoreFollow=function(t){return this.fetch({url:this.urlWithStmSource(this.url+"/"+t+"/reject"),type:"POST",cache:!1})},e.prototype.blockUser=function(t,o,e){var n;return null==e&&(e=function(){}),null!=t?this.fetch({url:this.urlWithStmSource(this.url+"/"+t+"/block"),type:"PUT",success:function(t,o){return e(o.follow_id)}}):(n={stm_source:this.stmSource,follow:{following_id:this.followerId,follower_id:o}},this.fetch({url:this.url+"/block",type:"POST",data:JSON.stringify(n),contentType:"application/json",success:function(t,o){return e(o.follow_id)}}))},e.prototype.unblockUser=function(t,o){return null==o&&(o=function(){}),this.fetch({url:this.url+"/"+t+"/unblock",type:"POST",cache:!1,success:function(){return o()}})},e.prototype.parse=function(){return{id:1}},e.prototype.urlWithStmSource=function(t){return this.stmSource?t+"?stm_source="+this.stmSource:t},e}(Backbone.Model)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.IgnoreAction=function(o){function e(t){e.__super__.constructor.call(this,t)}return t(e,o),e.prototype.execute=function(t){var o;return this.controller.ignoreFollow(t.data("follow")),o=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),o.fadeOut(300,function(){return o.remove()})},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.PendingApprovalAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#cancel_pending_button")}return t(e,o),e.prototype.execute=function(t){var o;return this.controller.cancelRequest(t.data("follow")),o=Strava.Follows.Factory.createFollowWithApprovalAction(this.athlete_id),o.enter(t)},e.prototype.enter=function(t){return t.replaceWith(this.template({}))},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.UnfollowAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#unfollow_button")}return t(e,o),e.prototype.execute=function(t){var o;return this.controller.unFollow(t.data("follow")),o=Strava.Follows.Factory.createFollowAction(this.athlete_id),o.enter(t)},e.prototype.enter=function(t){return t.replaceWith(this.template({}))},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows"),Strava.Follows.UnfollowForApprovalAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#unfollow_for_approval_button")}return t(e,o),e.prototype.execute=function(t){var o;return this.controller.unFollow(t.data("follow")),o=Strava.Follows.Factory.createFollowWithApprovalAction(this.athlete_id),o.enter(t)},e.prototype.enter=function(t){return t.replaceWith(this.template({}))},e}(Strava.Follows.Action)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows.Blocks"),Strava.Follows.Blocks.Action=function(o){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,o),e.prototype.handleSuccessExit=function(t){var o;return o=jQuery(this.selector+"[data-athlete-id='"+this.athlete_id+"']").find("a.secondary[data-follow]"),o.attr("data-follow",t).removeClass("disabled").removeClass("current-action")},e.prototype.handleListHide=function(t,o){var e,n;return n=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),e=n.find(".h4 a").text(),n.fadeOut("fast",function(){return n.empty().addClass("centered").text(Strava.I18n.Locale.t(o,{name:e})),n.addClass("action-success").fadeIn("fast").animate({"min-height":0},"fast")})},e}(Strava.Follows.Action)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["follows/block_follow"]=function(t){return function(){var t,o,e;return o=window.HAML.escape,t=window.HAML.cleanValue,e=[],e.push("<a class='alt button follow primary small' data-state='follow' href='javascript:;'>"+o(t(Strava.I18n.Locale.t("templates.follows.generic.follow")))+"</a>\n<div class='drop-down-menu transparent'>\n  <div class='gear selection'>&nbsp;</div>\n  <ul class='options'>\n    <li>\n      <a class='block nav secondary' data-follow=''>"+o(t(Strava.I18n.Locale.t("templates.follows.generic.block_athlete")))+"</a>\n    </li>\n    <li>\n      <a class='block nav secondary' href='javascript:;'>"+o(t(Strava.I18n.Locale.t("templates.follows.generic.whats_blocking")))+"</a>\n    </li>\n  </ul>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["follows/block_requires_approval"]=function(t){return function(){var t,o,e;return o=window.HAML.escape,t=window.HAML.cleanValue,e=[],e.push("<a class='btn-primary button follow' data-state='follow_with_approval' href='javascript:;'>"),e.push("  "+o(t(Strava.I18n.Locale.t("templates.follows.generic.request_follow")))),e.push("</a>\n<div class='drop-down-menu transparent'>\n  <div class='gear selection'>&nbsp;</div>\n  <ul class='options'>\n    <li>\n      <a class='block nav secondary' href='javascript:;' data-follow=''>"),e.push("        "+o(t(Strava.I18n.Locale.t("templates.follows.generic.block_athlete")))),e.push("      </a>\n    </li>\n    <li>\n      <a class='block nav secondary' href='javascript:;'>"),e.push("        "+o(t(Strava.I18n.Locale.t("templates.follows.generic.whats_blocking")))),e.push("      </a>\n    </li>\n  </ul>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["follows/only_block_follow"]=function(t){return function(){var t,o,e;return o=window.HAML.escape,t=window.HAML.cleanValue,e=[],e.push("<div class='drop-down-menu'>\n  <div class='gear selection'>&nbsp;</div>\n  <ul class='options'>\n    <li>\n      <a class='block nav secondary' href='javascript:;' data-follow=''>"),e.push("        "+o(t(Strava.I18n.Locale.t("templates.follows.generic.block_athlete")))),e.push("      </a>\n    </li>\n    <li>\n      <a class='block nav secondary' href='javascript:;'>"),e.push("        "+o(t(Strava.I18n.Locale.t("templates.follows.generic.whats_blocking")))),e.push("      </a>\n    </li>\n  </ul>\n</div>"),e.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows.Blocks"),Strava.Follows.Blocks.BlockAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.createTemplate("#block-light-box")}return t(e,o),e.prototype.execute=function(t){return this.showBox(t)},e.prototype.handleEnter=function(){},e.prototype.handleBlock=function(){},e.prototype.handleCancel=function(){},e.prototype.showBox=function(t){var o,e;return o=jQuery(this.template({})),jQuery("body").append(o),this.handleEnter(t),e=function(e){return function(){return e.$document().one("click",function(){return e.handleCancel(t),o.remove()})}}(this),setTimeout(e,0),o.click(function(){return!1}),o.find("a.confirm-block").click(function(e){return function(){return e.handleBlock(t),jQuery("ul li#blocked-followers-tab").fadeIn(),o.remove(),!1}}(this)),o.find("a.cancel").click(function(e){return function(){return e.handleCancel(t),o.remove(),!1}}(this))},e}(Strava.Follows.Blocks.Action),Strava.Follows.Blocks.ListBlockAction=function(o){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,o),e.prototype.handleEnter=function(t){return t.closest("li[data-athlete-id='"+this.athlete_id+"']").addClass("highlight")},e.prototype.handleBlock=function(t){return this.handleListHide(t,"templates.follows.block_action"),this.controller.blockUser(t.data("follow"),this.athlete_id)},e.prototype.handleCancel=function(t){var o;return o=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),o.removeClass("highlight")},e}(Strava.Follows.Blocks.BlockAction),Strava.Follows.Blocks.FormBlockAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.blockTemplate="follows/block_follow",this.blockOnlyTemplate="follows/only_block_follow",this.blockWithApproval="follows/block_requires_approval"}return t(e,o),e.prototype.enter=function(t){var o,e;return o=t.closest(this.selector),e=this.getTemplate(o),o.empty(),o.html(this.renderTemplate({},e))},e.prototype.getTemplate=function(t){var o,e;return o=t.data("is-blocked"),e=t.data("requires-approval"),o?this.blockOnlyTemplate:e?this.blockWithApproval:this.blockTemplate},e.prototype.handleBlock=function(t){var o,e;return e=function(o){return function(e){var n;return n=Strava.Follows.Blocks.Factory.createFormUnblockAction(o.athlete_id),n.enter(t),o.handleSuccessExit(e)}}(this),o=t.data("follow"),null!=o&&"string"==typeof o&&(o=(new Strava.Util.StringUtils).strip(o),0===o.length&&(o=null)),this.controller.blockUser(o,this.athlete_id,e)},e}(Strava.Follows.Blocks.BlockAction)}.call(this),function(){Strava.module("Strava.Follows.Blocks"),Strava.Follows.Blocks.Factory=function(){function t(){}return t.controller=null,t.createBlockMenu=function(t,o,e){return".follow-action"===e?this.createFormBlockMenu(t,o):this.createListBlockMenu(t,o)},t.createFormBlockMenu=function(t,o){switch(t){case"block":return this.createFormBlockAction(o);case"unblock":return this.createFormUnblockAction(o)}},t.createListBlockMenu=function(t,o){switch(t){case"block":return this.createListBlockAction(o);case"unblock":return this.createListUnblockAction(o);case"removeFollower":return this.createListRemoveAction(o)}},t.createActionFromClass=function(t,o){var e;return e=new t(o),e.setController(this.controller),e},t.createListBlockAction=function(t){return this.createActionFromClass(Strava.Follows.Blocks.ListBlockAction,t)},t.createListUnblockAction=function(t){return this.createActionFromClass(Strava.Follows.Blocks.ListUnblockAction,t)},t.createListRemoveAction=function(t){return this.createActionFromClass(Strava.Follows.Blocks.ListRemoveAction,t)},t.createFormBlockAction=function(t){var o;return o=this.createActionFromClass(Strava.Follows.Blocks.FormBlockAction,t),o.use_selector(".follow-action"),o},t.createFormUnblockAction=function(t){var o;return o=this.createActionFromClass(Strava.Follows.Blocks.FormUnblockAction,t),o.use_selector(".follow-action"),o},t}()}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows.Blocks"),Strava.Follows.Blocks.RemoveAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#remove-light-box")}return t(e,o),e.prototype.execute=function(t){return this.show_box(t)},e.prototype.handleEnter=function(){},e.prototype.handleRemove=function(){},e.prototype.handleCancel=function(){},e.prototype.show_box=function(t){var o,e;return o=jQuery(this.template({})),jQuery("body").append(o),this.handleEnter(t),e=function(e){return function(){return e.$document().one("click",function(){return e.handleCancel(t),o.remove()})}}(this),setTimeout(e,0),o.click(function(){return!1}),o.find("a.confirm-block").click(function(e){return function(){return e.handleRemove(t),o.remove(),!1}}(this)),o.find("a.cancel").click(function(e){return function(){return e.handleCancel(t),o.remove(),!1}}(this))},e}(Strava.Follows.Blocks.Action),Strava.Follows.Blocks.ListRemoveAction=function(o){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,o),e.prototype.handleEnter=function(t){return t.closest("li[data-athlete-id='"+this.athlete_id+"']").addClass("highlight")},e.prototype.handleRemove=function(t){return this.handleListHide(t,"templates.follows.remove_action"),this.controller.removeFollow(t.data("follow"))},e.prototype.handleCancel=function(t){var o;return o=t.closest("li[data-athlete-id='"+this.athlete_id+"']"),o.removeClass("highlight")},e}(Strava.Follows.Blocks.RemoveAction)}.call(this),function(){var t=function(t,e){function n(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},o={}.hasOwnProperty;Strava.module("Strava.Follows.Blocks"),Strava.Follows.Blocks.UnblockAction=function(o){function e(t){e.__super__.constructor.call(this,t)}return t(e,o),e.prototype.execute=function(){},e}(Strava.Follows.Blocks.Action),Strava.Follows.Blocks.ListUnblockAction=function(o){function e(){return e.__super__.constructor.apply(this,arguments)}return t(e,o),e.prototype.execute=function(t){return this.controller.unblockUser(t.data("follow")),this.handleListHide(t,"templates.follows.unblock_action")},e}(Strava.Follows.Blocks.UnblockAction),Strava.Follows.Blocks.FormUnblockAction=function(o){function e(t){e.__super__.constructor.call(this,t),this.create_template("#unblock_follow_template")}return t(e,o),e.prototype.enter=function(t){var o;return o=t.closest(this.selector),o.empty(),o.html(this.template({}))},e.prototype.execute=function(t){var o;return o=function(o){return function(){var e;return e=Strava.Follows.Blocks.Factory.createFormBlockAction(o.athlete_id),e.enter(t),o.handleSuccessExit("")}}(this),this.controller.unblockUser(t.data("follow"),o)},e}(Strava.Follows.Blocks.UnblockAction)}.call(this);