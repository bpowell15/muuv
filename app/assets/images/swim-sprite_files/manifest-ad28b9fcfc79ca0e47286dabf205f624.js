(function(){Strava.module("Strava.Ui.Global"),Strava.Ui.Global=function(){function t(){}return t.prepareAutoresizingTextbox=function(){return jQuery(document).on("focus","textarea.autoresize",function(){var t;return t=jQuery(this),t.siblings("div.textarea-clone").length?void 0:t.addClass("noresize").after("<div class='textarea-clone'></div>").bind("keydown paste",function(){return setTimeout(function(){return function(){var e,n,i;return e=t.next(),i=t.val()+"W",e.text(i),n=e.outerHeight(),t.siblings(".mentions").css("height",n),t.css("height",n)}}(this),10)})})},t}()}).call(this),function(){null==window.JST&&(window.JST={}),window.JST["athletes/athlete_list_element"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media'>\n  <div class='media-object'>\n    <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.name))+"'>\n      <img class='avatar-img' src='"+e(t(this.athlete.avatar_url))+"' alt='"+e(t(this.athlete.name))+"' title='"+e(t(this.athlete.name))+"'>\n    </a>\n  </div>\n  <div class='media-content'>\n    <div class='media-body'>\n      <div class='name'>\n        <a class='athlete-name minimal' href='/athletes/"+e(t(this.athlete.id))+"'>"),n.push("          "+e(t(this.athlete.name))),this.athlete.member_type&&n.push("          <div class='app-icon-wrapper'>\n            <div class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>\n          </div>"),n.push("        </a>\n        <span class='activity-title'>"+t("&ndash; "+this.athlete.activity_link)+"</span>\n      </div>\n      <div class='location'>"+e(t(this.athlete.location))+"</div>\n    </div>\n    <div class='action-buttons media-actions'>\n      <span class='follow-action follow-button'>\n        <div class='stub'></div>\n      </span>"),this.athlete.activity_id&&parseInt(this.activityAthlete.id)===currentAthlete.id&&(n.push("      <div class='btn btn-default btn-sm button fixed-small remove-athlete'>"),n.push("        "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.remove_athlete")))),n.push("      </div>")),n.push("    </div>\n  </div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.AthleteListView=function(e){function n(t,e,i){this.athlete=t,this.entityId=e,this.activityAthlete=i,this.template="athletes/athlete_list_element",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .remove-athlete":"removeAthlete"},n.prototype.render=function(){var t;return this.renderTemplate({athlete:this.athlete,entityId:this.entityId,activityAthlete:this.activityAthlete}),jQuery(this.$el).find(".follow-button").attr("data-athlete-id",this.athlete.id),this.athlete.is_following||(t=this.athlete.is_private?Strava.Follows.Factory.createFollowWithApprovalAction(this.athlete.id):Strava.Follows.Factory.createFollowAction(this.athlete.id),t.enter(this.$(".follow-button .stub"))),this},n.prototype.removeAthlete=function(){return confirm(Strava.I18n.Locale.t("templates.feed.lightbox.remove_athlete_confirm"))?jQuery.ajax({url:"/activities/"+this.entityId+"/grouping/"+this.athlete.activity_id,type:"DELETE",success:function(t){return function(){return t.$el.hide()}}(this)}):void 0},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.SocialController=function(e){function n(){this.hash={},n.__super__.constructor.call(this)}return t(n,e),n.prototype.addToHash=function(t,e){return e.length||(e=[]),this.hash[t]=e},n.prototype.addToKey=function(t,e){return null==this.hash[t]&&(this.hash[t]=[]),this.hash[t].push(e)},n.prototype.setHash=function(t){return""!==t?this.hash=t:void 0},n.prototype.getFromHash=function(t){return this.hash[t]||[]},n.prototype.existsInHash=function(t){return null!=this.hash[t]},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.AchievementsController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.fetchAchievements=function(t,e,n,i){var r;return r=t+"-"+e,this.existsInHash(r)?void n(this.getFromHash(r)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"achievements"),success:function(t){return function(e,i){var o;return o=i.achievements,t.addToHash(r,o),n(o)}}(this),error:function(t,e){return null!=i?i(e):void 0}})},n}(Strava.Lib.SocialController)}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.CacheableModel={REQUEST_CACHE:{},read:function(t,e){var n,i,r;return r=t.url(),i=jQuery.Deferred(),n=Strava.Lib.CacheableModel.REQUEST_CACHE[r],null!=n?(t.set(n,e),i.resolve(n)):Backbone.sync("read",t,e).done(function(n){return t.set(n,e),Strava.Lib.CacheableModel.REQUEST_CACHE[r]=_.clone(n)}).done(function(){return i.resolve()}).fail(function(){return i.reject()}),i.promise()},sync:function(t,e,n){var i;return null==n&&(n={}),i=function(){switch(t){case"read":return n.cache?Strava.Lib.CacheableModel.read(e,n):Backbone.sync("read",e,n);case"create":throw new Error("Create not supported");case"update":throw new Error("Update not supported");case"delete":throw new Error("Delete not supported")}}(),n.success&&i.done(function(){return n.success()}),n.error&&i.fail(function(){return n.error()}),i}}}.call(this),function(){Strava.module("Strava.Lib"),Strava.Lib.EntityMap=function(){function t(){}return t.entity_map={Activity:"activity",AthleteFeedEntry:"athlete-feed-entry",Post:"post"},t.getUrl=function(t,e,n){return"/feed/"+this.entity_map[t]+"/"+e+"/"+n},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.CommentsController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.mentionFeature=null,n.prototype.initialize=function(){return this.commentable=!0},n.prototype.comment=function(t,e,n,i){var r,o;return r={comment:n,mentions:i},o=t+"-"+e,this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"comment"),type:"POST",data:JSON.stringify(r),contentType:"application/json",success:function(t){return function(e,n){return t.addToKey(o,n),t.dispatchCommentCreate(n,o)}}(this),complete:function(t){return function(){return t.dispatchCommentCompleted(o)}}(this)})},n.prototype.dispatchCommentCreate=function(t,e){return this.trigger("commentCreated",t,e)},n.prototype.dispatchCommentCompleted=function(t){return this.trigger("commentCompleted",t)},n.prototype.dispatchCommentDelete=function(t,e){return this.trigger("commentDeleted",t,e)},n.prototype.dispatchCommentsReturned=function(t){return this.trigger("commentsReturned",t)},n.prototype.deleteComment=function(t,e){return this.fetch({url:"/feed/comment",type:"DELETE",data:JSON.stringify({id:e}),contentType:"application/json",success:function(n){return function(i,r){return n.removeCommentFromHash(t,e),n.dispatchCommentDelete(t,r)}}(this)})},n.prototype.parse=function(){return{id:1}},n.prototype.setMentionFeature=function(t){return this.mentionFeature=t,this.trigger("mentionFeatureAdded",this.mentionFeature.mentionsData())},n.prototype.removeCommentFromHash=function(t,e){var n,i,r,o,a,s;for(i=this.getFromHash(t),s=[],r=o=0,a=i.length;a>o;r=++o){if(n=i[r],n.comment_id===e){i.splice(r,1);break}s.push(void 0)}return s},n.prototype.fetchComments=function(t,e,n,i){var r;return r=t+"-"+e,this.existsInHash(r)?void n(this.getFromHash(r)):this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,i){var o;return o=i.comments,t.addToHash(r,o),n(o)}}(this),error:function(t,e){return null!=i?i(e):void 0}})},n.prototype.forceFetchComments=function(t,e){var n;return n=t+"-"+e,this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"comments"),success:function(t){return function(e,i){return t.addToHash(n,i.comments)}}(this)})},n}(Strava.Lib.SocialController)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.KudosController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.kudo=function(t,e){return this.save(null,{url:Strava.Lib.EntityMap.getUrl(t,e,"kudo"),contentType:"application/json",type:"POST",success:function(n){return function(){return n.dispatchKudosCreate(t,e)}}(this)})},n.prototype.dispatchKudosCreate=function(t,e){return this.trigger("kudoCreated",t,e)},n.prototype.fetchKudos=function(t,e,n,i){return this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"kudos"),success:function(t,e){return n(e.athletes,e.kudosable,e.isOwner)},error:function(){return i("")}})},n.prototype.parse=function(){return{id:1}},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava"),Strava.base_module={initializeAttributes:function(t){var e,n,i;n=[];for(e in t)i=t[e],n.push(this.initAttribute(e,i));return n},setOrGet:function(t,e){return void 0!==e?(this[t]=e,this):this[t]},initAttribute:function(t,e){var n;return this.constructor.prototype[t]=function(t){return this.setOrGet(n,t)},n="_"+t,this[n]=!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor?e:_.clone(e)},create_template:function(t){var e;return e=jQuery(t),this.template=_.template(e.html())},create_template_for:function(t){var e;return e=jQuery(t),_.template(e.html())}},Strava.chart_module={shouldAnimate:function(t){return null!=this.animate()?this.animate():t}},Strava.local_storage_module={initializeStorageAttributes:function(t,e,n){var i,r,o;null==n&&(n=!1),n&&this.setLocalStorage(e,{}),r=[];for(i in t)o=t[i],r.push(this.initStorageAttribute(i,o,e));return r},getLocalStorage:function(t){var e;return e=localStorage[t],e?JSON.parse(localStorage[t])||{}:{}},setLocalStorage:function(t,e){return localStorage[t]=JSON.stringify(e)},setOrGetStorage:function(t,e,n){var i;return i=this.getLocalStorage(n),void 0!==e?(i[t]=e,this.setLocalStorage(n,i),this):i[t]},initStorageAttribute:function(t,e,n){var i,r;if(this.constructor.prototype[t]=function(t){return this.setOrGetStorage(i,t,n)},i="_"+t,!_.isObject(e)||_.isFunction(e)||e.constructor!==Object.prototype.constructor&&e.constructor!==Array.prototype.constructor)return r=this.setOrGetStorage(i,void 0,n),void 0!==r&&(e=r),this.setOrGetStorage(i,e,n);throw new Error("cannot store non-primitive types in localstorage")}},Strava.Base=function(){function t(){}return Strava.includeModule(t,Backbone.Events),Strava.includeModule(t,Strava.base_module),t.prototype.$=function(t,e){return e.find(t)},t.prototype.$$=function(t){return jQuery(t)},t.prototype.$document=function(){return jQuery(document)},t.prototype.one=function(t,e,n){var i,r,o,a;return a=this,i=e,r=t,o=function(){return i.call(this),a.unbind(r,o)},this.bind(t,o,n)},t.prototype.createHandler=function(t){return function(){var e;return e=Array.prototype.slice.call(arguments),e.unshift(this),t.apply(null,e)}},t.prototype.isTouchDevice=function(){return Modernizr?Modernizr.touch:!1},t}(),Strava.Controller=function(e){function n(){n.__super__.constructor.call(this)}return t(n,e),Strava.includeModule(n,Strava.base_module),n.prototype.parse=function(){return{id:0}},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Lib"),Strava.Lib.MentionFeature=function(e){function n(t,e){n.__super__.constructor.call(this),this.initializeAttributes(i),this.missingImageURL(e),this.formattedData(_.map(t,function(t){return function(e){return t.formatData(e)}}(this))),this.mentionsData({onDataRequest:function(t){return function(e,n,i){return t.handleDataRequest(e,n,i)}}(this)})}var i;return t(n,e),i={mentionsData:{},formattedData:{},missingImageURL:null},n.prototype.formatData=function(t){return{id:t.id,avatar:t.picture,type:"contact",name:t.text}},n.prototype.handleDataRequest=function(t,e,n){var i;return i=this.formattedData(),i=_.filter(i,function(){return function(t){return t.name.toLowerCase().indexOf(e.toLowerCase())>-1}}(this)),n.call(this,i)},n}(Strava.Base)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/loading_box"]=function(t){return function(){var t;return t=[],t.push("<div class='centerAlign pb-lg pt-lg'>\n  <div class='sm spinner vcentered'>\n    <div class='graphic'></div>\n  </div>\n</div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.SocialBoxView=function(e){function n(){this.selected=!1,this.loadingTemplate="feed/loading_box"}return t(n,e),n.prototype.renderLoading=function(){return this.renderTemplate({},this.loadingTemplate)},n.prototype.unselect=function(){return this.selected=!1},n.prototype.select=function(){return this.selected=!0},n.prototype.show=function(){},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/achievement_box"]=function(t){return function(){var t;return t=[],t.push("<ul class='achievements list-achievements'></ul>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/achievement"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='"+["app-icon","icon-sm",""+e(t(this.achievement.sprite))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>\n<div class='effort'>\n  <a href='/activities/"+e(t(this.achievement.activity_id))+"/segments/"+e(t(this.achievement.id))+"'>"+e(t(this.achievement.name))+"</a>\n  <strong>"+e(t(this.achievement.description))+"</strong>"),n.push("  "+t("("+this.achievement.elapsed_time+")")),n.push("</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.AchievementsView=function(e){function n(t,e,i){this.controller=t,this.entity=e,this.entity_id=i,this.template="feed/achievement_box",n.__super__.constructor.call(this)}return t(n,e),n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchAchievements(this.entity,this.entity_id,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(){return t.renderEmpty()}}(this)),this},n.prototype.renderEmpty=function(){return this.renderTemplate()},n.prototype.handleSuccess=function(t){var e,n,i,r;for(this.renderEmpty(),n=[],i=0,r=t.length;r>i;i++)e=t[i],n.push(this.createAchievementElement(e));return n.length&&this.$(".achievements").append(n).find("li").fadeIn("fast"),this},n.prototype.createAchievementElement=function(t){var e;return e=new Strava.Feed.Achievement(t),e.render().el},n}(Strava.Feed.SocialBoxView),Strava.Feed.Achievement=function(e){function n(t){this.achievement=t,this.template="feed/achievement",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.attributes={style:"display: none"},n.prototype.render=function(){return this.renderTemplate({achievement:this.achievement}),this},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CardEntryItemActionView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="button",n.prototype.className="btn btn-sm str-click-self-js",n.prototype.events={click:"handleClick"},n.prototype.render=function(){return"on"===this.model.actionState()?this.$el.removeClass("btn-default").addClass("btn-primary"):this.$el.removeClass("btn-primary").addClass("btn-default"),this.$el.attr("str-target-url",this.model.trackableTargetUrl()),this.$el.text(this.model.label()),this},n.prototype.isLocked=function(){return this.$el.prop("disabled")},n.prototype.lock=function(){return this.$el.prop("disabled",!0)},n.prototype.unlock=function(){return this.$el.prop("disabled",!1)},n.prototype.handleClick=function(){return this.isLocked()?void 0:(this.lock(),this.model.execute().done(function(t){return function(){return t.render()}}(this)).always(function(t){return function(){return t.unlock()}}(this)))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CardEntryItemView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="card-entry-item",n.prototype.id=function(){return this.model.get("impression_key")?this.model.get("impression_key"):void 0},n.prototype.events={"click .dismiss-action":"handleDismissAction"},n.prototype.initialize=function(){return this.create_template("#card-entry-item-template")},n.prototype.hide=function(){return this.$el.hide()},n.prototype.attachToDom=function(t){return this.setElement(t),new Strava.Feed.CardEntryItemActionView({el:this.$(".media-body .action .btn"),model:this.model.actions().first()}),this.avatar(),this},n.prototype.render=function(){var t;return this.renderTemplate({title:this.model.title(),subtitle:this.model.subtitle(),destination_url:this.model.destinationUrl(),avatar_shape:this.model.avatarShape()}),t=new Strava.Feed.CardEntryItemActionView({model:this.model.actions().first()}),this.$el.find(".media-body .action").html(t.render().el),this.avatar(),this.addTracking(),this},n.prototype.avatar=function(){return this.model.avatar().done(function(t){return function(e,n){return n.className="avatar-img",t.$(".avatar-content").html(n)}}(this))},n.prototype.addTracking=function(){var t;return this.model.get("trackable_id")?(this.$el.attr("str-trackable-id",this.model.get("trackable_id")),this.model.hasDismissAction()&&this.$(".dismiss-action").attr("str-target-url",this.model.dismissAction().trackableTargetUrl()),t={"str-on":"click","str-trackable-id":this.model.get("trackable_id")},["avatar","name","self","kudos","comment-list","photo","anchor-container"].forEach(function(e){return function(n){var i;return t["str-type"]=n.replace("-","_"),"anchor-container"===n?(i=_.extend({"click-type":"link"},t),e.$(".str-click-anchor-container-self-js").attr(i)):e.$(".str-click-"+n+"-js").attr(t)}}(this))):void 0},n.prototype.handleDismissAction=function(){return this.$el.prop("disabled")?void 0:(this.$el.prop("disabled",!0),this.model.dismissAction().execute().done(function(t){return function(){return t.trigger("cardEntryItem:dismiss")}}(this)).always(function(t){return function(){return t.$el.prop("disabled",!1)}}(this)))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Member=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.urlRoot=function(){return"/clubs/"+this.get("club_id")+"/members"},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.ClubJoinButtonView=function(e){function n(t,e){n.__super__.constructor.call(this,{el:t}),this.memberModel=new Strava.Models.Member(e)}return t(n,e),n.prototype.events={click:"joinClub"},n.prototype.joinClub=function(t){return t.preventDefault(),this.$el.prop("disabled",!0),this.submitRequest()},n.prototype.submitRequest=function(){return this.memberModel.save({},{success:function(t){return function(){return t.$el.val(Strava.I18n.Locale.t("strava.feed.club_join_button_view.joined"))}}(this),error:function(t){return function(){return t.$el.prop("disabled",!1),alert(Strava.I18n.Locale.t("strava.feed.club_join_button_view.error"))}}(this)})},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_box"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='comments'>\n  <p class='no-comments'>"+e(t(Strava.I18n.Locale.t("templates.feed.comment_box.no_comments")))+"</p>\n  <ol class='thread'></ol>\n  <form class='media'>\n    <div class='media-left'>\n      <div class='avatar avatar-athlete avatar-sm'>\n        <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"' title='"+e(t(this.athlete.display_name))+"'>\n      </div>\n    </div>\n    <div class='media-content'>\n      <div class='media-body'>\n        <textarea class='autoresize' name='comment[comment]'></textarea>\n      </div>\n      <div class='media-actions'>\n        <input class='btn btn-default btn-xs compact' type='submit' value='"+e(t(Strava.I18n.Locale.t("templates.feed.comment_box.post")))+"'>\n      </div>\n    </div>\n  </form>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_box_comment"]=function(t){return function(){var t,e,n,i,r,o,a;if(e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media-left'>\n  <a class='avatar avatar-athlete avatar-sm'>\n    <img class='avatar-img' src='"+e(t(this.athlete.avatar_url))+"' alt='"+e(t(this.athlete.name))+"' title='"+e(t(this.athlete.name))+"'>\n  </a>\n</div>\n<div class='comment media-body'>\n  <a class='athlete-name' href='/athletes/"+e(t(this.athlete.id))+"'>"+e(t(this.athlete.name))+"</a>\n  <span class='comment-text'>"),_.isString(this.comment))n.push("    "+e(t(this.comment)));else for(o=this.comment,i=0,r=o.length;r>i;i++)a=o[i],n.push("mention_token"===a.type?"    <a class='mentioned-athlete' href='"+e(t(a.path))+"'>"+e(t(a.text))+"</a>":"    "+e(t(a.text)));return n.push("  </span>\n  <br>"),n.push("  "+t(this.timestamp)),n.push("</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/delete_link"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<button class='btn btn-unstyled btn-xs remove' data-comment-id='"+e(t(this.comment_id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.feed.delete_link.remove_title")))+"'>\n  <div class='app-icon-wrapper'>\n    <div class='app-icon icon-dark icon-remove'>"+e(t(Strava.I18n.Locale.t("templates.feed.comment_feed.remove")))+"</div>\n  </div>\n</button>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.CommentBoxView=function(e){function n(t,e,i){this.controller=t,this.entity=e,this.entity_id=i,this.template="feed/comment_box",this.controller.bind("mentionFeatureAdded",function(t){return function(e){return t.renderMentionFeature(e)}}(this)),this.controller.bind("commentCreated",function(t){return function(e){var n,i;return i=t.createCommentElem(e),t.$("p.no-comments").remove(),n=t.$("ol.thread"),n.length?(n.scrollTop(n[0].scrollHeight),n.append(i).find("li").slideDown(),t.$("form textarea").val(""),t.$(".mentions div").html("")):void 0}}(this)),this.controller.bind("commentCompleted",function(t){return function(){return t.$("form input[type='submit']").removeAttr("disabled")}}(this)),n.__super__.constructor.call(this)}return t(n,e),n.prototype.events={"submit form":"createComment"},n.prototype.createCommentElem=function(t){var e;return e=new Strava.Feed.CommentBoxComment(this.controller,t,this.entity,this.entity_id),e.render().el},n.prototype.createComment=function(){var t;return t=jQuery.trim(this.$("form textarea").val()),null!=this.controller.mentionFeature?this.$("textarea").mentionsInput("val",function(e){return function(n){return e.$("textarea").mentionsInput("getMentions",function(i){return t=n,t.length?(e.$("form input[type='submit']").attr("disabled","disabled"),e.controller.comment(e.entity,e.entity_id,t,i)):void 0})}}(this)):t.length&&(this.$("form input[type='submit']").attr("disabled","disabled"),this.controller.comment(this.entity,this.entity_id,t,{})),!1},n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchComments(this.entity,this.entity_id,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(){return t.renderEmpty()}}(this)),this},n.prototype.renderEmpty=function(){return this.renderTemplate({athlete:currentAthlete.toJSON()}),this.controller.commentable?this.$("textarea").focus():this.$("form").hide()},n.prototype.handleSuccess=function(t){var e,n,i,r;for(this.renderEmpty(),n=[],i=0,r=t.length;r>i;i++)e=t[i],n.push(this.createCommentElem(e));return n.length&&(this.$(".no-comments").remove(),this.$("ol.thread").append(n).find("li").fadeIn("fast")),this},n.prototype.renderMentionFeature=function(t){return this.$el?this.$("textarea").mentionsInput(t):void 0},n}(Strava.Feed.SocialBoxView),Strava.Feed.CommentBoxComment=function(e){function n(t,e,i,r){this.controller=t,this.comment=e,this.template="feed/comment_box_comment",this.thread_key=i+"-"+r,n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.className="media",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .remove":"deleteComment"},n.prototype.deleteComment=function(){return confirm(Strava.I18n.Locale.t("strava.feed.comment_box_view.confirm_delete"))&&(this.controller.deleteComment(this.thread_key,this.comment.comment_id),this.$el.slideUp("fast",function(t){return function(){return t.remove()}}(this))),!1},n.prototype.render=function(){var t,e,n,i,r,o,a,s;for(this.renderTemplate({athlete:this.comment.athlete,comment:this.comment.comment,timestamp:this.comment.timestamp}),a=this.$("time.timeago"),r=0,o=a.length;o>r;r++)i=a[r],t=this.$(i),(e=t.attr("datetime"))&&(s=Strava.I18n.TimespanFormatter.timeago(Date.parse(e)),t.html(s));return this.comment.deletable&&(n=this.getTemplateFor("feed/delete_link"),this.$el.append(n({comment_id:this.comment.comment_id}))),this},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/comment_feed"]=function(t){return function(){var t,e,n,i,r,o,a;if(e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<div class='media-left'>\n  <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.display_name))+"'>\n    <img src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"'>\n  </a>\n</div>\n<div class='comment media-body'>\n  <a class='athlete-name' href='/athletes/"+e(t(this.athlete.id))+"'>"+e(t(this.athlete.display_name))+"</a>\n  <span class='comment-text'>"),_.isString(this.comment))n.push("    "+e(t(this.comment)));else for(o=this.comment,i=0,r=o.length;r>i;i++)a=o[i],n.push("mention_token"===a.type?"    <a class='mentioned-athlete' href='"+e(t(a.path))+"'>"+e(t(a.text))+"</a>":"    "+e(t(a.text)));return n.push("  </span>\n  <br>"),n.push("  "+t(this.timestamp)),n.push("</div>\n<div class='media-actions'>\n  <button class='btn btn-icon btn-icon-only btn-sm btn-unstyled remove' data-comment-id='"+e(t(this.comment_id))+"' title='"+e(t(Strava.I18n.Locale.t("templates.feed.comment_feed.remove_title")))+"'>\n    <div class='app-icon-wrapper'>\n      <div class='app-icon icon-dark icon-remove'>"+e(t(Strava.I18n.Locale.t("templates.feed.comment_feed.remove")))+"</div>\n    </div>\n  </button>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.EntityView=function(e){function n(t,e){this.commentsController=t,this.kudosController=e,this.prepareResponseBindings(),this.prepareFeedBindings(),n.__super__.constructor.call(this)}return t(n,e),n.prototype.renderMentionFeature=function(t){return this.$$("textarea").mentionsInput(t)},n.prototype.prepareResponseBindings=function(){return this.commentsController.bind("commentCreated",function(t){return function(e,n){var i,r,o;return i=jQuery("#"+n),r=i.find(".comments ol.thread"),r.length&&(i.find(".comments form").find(".mentions div").html(""),o=jQuery(new Strava.Feed.Comment(e).render().el),r.append(o)),i.find(".comments form textarea").val(""),t.updateCommentCount(n,1)}}(this)),this.commentsController.bind("mentionFeatureAdded",function(t){return function(e){return t.renderMentionFeature(e)}}(this)),this.commentsController.bind("commentCompleted",function(){return function(t){var e;return e=jQuery("#"+t),e.find(".comments form input[type='submit']").removeAttr("disabled")}}(this)),this.commentsController.bind("commentDeleted",function(t){return function(e,n){var i;return i=jQuery("[data-entity-id="+e+"]").find("ol.thread [data-comment-id='"+n.id+"']"),i.closest("li").remove(),t.updateCommentCount(e,-1)}}(this)),this.kudosController.bind("kudoCreated",function(){return function(t,e){var n,i,r,o;return o=t+"-"+e,r=jQuery("#"+o),r.find(".btn-kudo").removeClass("empty js-add-kudo").addClass("kudoed js-view-kudos").attr("title",Strava.I18n.Locale.t("strava.feed.entity_view.view_all_kudos")),r.find(".btn-kudo .app-icon").removeClass("icon-dark").addClass("kudoed icon-color").end(),r.find(".kudos-facepile .avatar.hidden").removeClass("hidden").end(),r.find(".kudos-count-wrapper").removeClass("empty js-add-kudo").end(),r.find(".js-give-kudos-cta").addClass("hidden").end(),n=r.find(".count-kudos"),i=n.data("kudo-count")+1,n.data("kudo-count",i),n.text(i)}}(this))},n.prototype.prepareFeedBindings=function(){return jQuery(".page").on("submit",".feed .comments form",function(t){return function(e){var n,i,r;return n=jQuery(e.target),null!=t.commentsController.mentionFeature?n.find("textarea").mentionsInput("val",function(e){return n.find("textarea").mentionsInput("getMentions",function(i){var r,o;
return o=e,r=n.data("entry"),o.length?(n.find("input[type='submit']").attr("disabled","disabled"),t.commentsController.comment(r[0],r[1],o,i)):void 0})}):(i=n.data("entry"),r=n.find("textarea").val(),r.length&&(n.find("input[type='submit']").attr("disabled","disabled"),t.commentsController.comment(i[0],i[1],r,{}))),!1}}(this)).on("click",".feed .js-add-kudo",function(t){return function(e){var n,i;return n=jQuery(e.currentTarget),n.addClass("kudoed"),i=n.data("entry"),t.kudosController.kudo(i[0],i[1]),!1}}(this)).on("click",".feed .comments ol.thread .remove",function(t){return function(e){var n,i;return confirm(Strava.I18n.Locale.t("strava.feed.comment_box_view.confirm_delete"))&&(n=jQuery(e.target),i=n.closest("[data-entity-id]").data("entity-id"),t.commentsController.deleteComment(i,n.data("comment-id"))),!1}}(this))},n.prototype.updateCommentCount=function(t){var e,n,i,r;return i=jQuery("#"+t),e=i.find(".count-comments"),r=i.find(".js-view-comments .count-label"),n=this.commentsController.getFromHash(t).length,0===n?(e.parent().addClass("empty"),e.parents().find(".comments-count-wrapper").addClass("empty"),e.closest(".social").find(".show-all").hide()):(e.parent().removeClass("empty"),e.parents().find(".comments-count-wrapper").removeClass("empty")),r.html(Strava.I18n.Locale.t("strava.feed.comment_count",{count:n})),e.html(n),i.find(".link-count").text(n)},n}(Backbone.View),Strava.Feed.Comment=function(e){function n(t){this.data=t,this.template="feed/comment_feed",n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.className="deletable media",n.prototype.render=function(){var t,e,n,i,r,o,a;for(this.renderTemplate({athlete:currentAthlete.toJSON(),comment:this.data.comment,comment_id:this.data.comment_id,timestamp:this.data.timestamp}),o=this.$("time.timeago"),i=0,r=o.length;r>i;i++)n=o[i],t=this.$(n),(e=t.attr("datetime"))&&(a=Strava.I18n.TimespanFormatter.timeago(Date.parse(e)),t.html(a));return this},n}(Backbone.View)}.call(this),function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(t){var n=e[a][1][t];return r(n?n:t)},u,u.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e){/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
e.exports={VERSION:"1.0.0",DEV_ID:"i5iSjo",VERSION_PARAM:"&_av",USAGE_PARAM:"&_au",NULL_DIMENSION:"(not set)"}},{}],2:[function(t){function e(){console.error("Warning! Requiring the `autotrack` plugin no longer requires  all sub-plugins by default.\nSee https://goo.gl/XsXPg5 for details.")}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("../provide");n("autotrack",e)},{"../provide":12}],3:[function(t){function e(t,e){a.track(t,a.plugins.CLEAN_URL_TRACKER),this.opts=n({stripQuery:!1,queryDimensionIndex:null,indexFilename:null,trailingSlash:null},e),this.tracker=t,this.overrideTrackerBuildHitTask()}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("dom-utils/lib/parse-url"),r=t("../constants"),o=t("../provide"),a=t("../usage");e.prototype.cleanUrlTask=function(t){var e=t.get("location"),n=t.get("page"),o=i(n||e),a=o.pathname,s=a;if(this.opts.indexFilename){var c=s.split("/");this.opts.indexFilename==c[c.length-1]&&(c[c.length-1]="",s=c.join("/"))}if("remove"==this.opts.trailingSlash)s=s.replace(/\/+$/,"");else if("add"==this.opts.trailingSlash){var l=/\.\w+$/.test(s);l||"/"==s.substr(-1)||(s+="/")}this.opts.stripQuery&&this.opts.queryDimensionIndex&&t.set("dimension"+this.opts.queryDimensionIndex,o.query||r.NULL_DIMENSION),t.set("page",s+(this.opts.stripQuery?"":o.search))},e.prototype.overrideTrackerBuildHitTask=function(){this.originalTrackerBuildHitTask=this.tracker.get("buildHitTask"),this.tracker.set("buildHitTask",function(t){this.cleanUrlTask(t),this.originalTrackerBuildHitTask(t)}.bind(this))},e.prototype.remove=function(){this.tracker.set("sendHitTask",this.originalTrackerSendHitTask)},o("cleanUrlTracker",e)},{"../constants":1,"../provide":12,"../usage":13,"dom-utils/lib/parse-url":22,"object-assign":23}],4:[function(t){function e(t,e){if(o.track(t,o.plugins.EVENT_TRACKER),window.addEventListener){this.opts=n({events:["click"],fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleEvents=this.handleEvents.bind(this);var r="["+this.opts.attributePrefix+"on]";this.delegates={},this.opts.events.forEach(function(t){this.delegates[t]=i(document,t,r,this.handleEvents,{composed:!0,useCapture:!0})}.bind(this))}}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("dom-utils/lib/delegate"),r=t("../provide"),o=t("../usage"),a=t("../utilities").createFieldsObj,s=t("../utilities").getAttributeFields;e.prototype.handleEvents=function(t,e){var i=this.opts.attributePrefix;if(t.type==e.getAttribute(i+"on")){var r=t.target.tagName,o=t.target==e,c={transport:"beacon",targetTagName:r,isCurrentTarget:o},l=s(e,i),u=n({},this.opts.fieldsObj,l),h=l.hitType||"event";this.tracker.send(h,a(c,u,this.tracker,this.opts.hitFilter,e))}},e.prototype.remove=function(){Object.keys(this.delegates).forEach(function(t){this.delegates[t].destroy()}.bind(this))},r("eventTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"object-assign":23}],5:[function(t){function e(t,e){if(o.track(t,o.plugins.IMPRESSION_TRACKER),window.IntersectionObserver&&window.MutationObserver){this.opts=i({elements:[],rootMargin:"0px",fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleDomMutations=this.handleDomMutations.bind(this),this.walkNodeTree=this.walkNodeTree.bind(this),this.handleIntersectionChanges=this.handleIntersectionChanges.bind(this),this.startObserving=this.startObserving.bind(this),this.observeElement=this.observeElement.bind(this),this.handleDomElementRemoved=this.handleDomElementRemoved.bind(this);var n=this.deriveDataFromConfigOptions();this.items=n.items,this.elementMap=n.elementMap,this.threshold=n.threshold,this.intersectionObserver=this.initIntersectionObserver(),this.mutationObserver=this.initMutationObserver(),s(this.startObserving)}}function n(t,e){if(0===t){var n=e.intersectionRect;return n.top>0||n.bottom>0||n.left>0||n.right>0}return e.intersectionRatio>=t}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i=t("object-assign"),r=t("../provide"),o=t("../usage"),a=t("../utilities").createFieldsObj,s=t("../utilities").domReady,c=t("../utilities").getAttributeFields;e.prototype.deriveDataFromConfigOptions=function(){var t=[],e=[],n={};return this.opts.elements.forEach(function(r){"string"==typeof r&&(r={id:r}),t.push(r=i({threshold:0,trackFirstImpressionOnly:!0},r)),n[r.id]=null,e.push(r.threshold)}),{items:t,elementMap:n,threshold:e}},e.prototype.initMutationObserver=function(){return new MutationObserver(this.handleDomMutations)},e.prototype.initIntersectionObserver=function(){return new IntersectionObserver(this.handleIntersectionChanges,{rootMargin:this.opts.rootMargin,threshold:this.threshold})},e.prototype.startObserving=function(){Object.keys(this.elementMap).forEach(this.observeElement),this.mutationObserver.observe(document.body,{childList:!0,subtree:!0}),requestAnimationFrame(function(){})},e.prototype.observeElement=function(t){var e=this.elementMap[t]||(this.elementMap[t]=document.getElementById(t));e&&this.intersectionObserver.observe(e)},e.prototype.handleDomMutations=function(t){for(var e,n=0;e=t[n];n++){for(var i,r=0;i=e.removedNodes[r];r++)this.walkNodeTree(i,this.handleDomElementRemoved);for(var o,a=0;o=e.addedNodes[a];a++)this.walkNodeTree(o,this.observeElement)}},e.prototype.walkNodeTree=function(t,e){1==t.nodeType&&t.id in this.elementMap&&e(t.id);for(var n,i=0;n=t.childNodes[i];i++)this.walkNodeTree(n,e)},e.prototype.handleIntersectionChanges=function(t){for(var e,i=0;e=t[i];i++)for(var r,o=0;r=this.items[o];o++)e.target.id===r.id&&(n(r.threshold,e)?(this.handleImpression(r.id,!0),r.trackFirstImpressionOnly&&(this.items.splice(o,1),o--,this.possiblyUnobserveElement(r.id))):this.handleImpression(r.id,!1));0===this.items.length&&this.remove()},e.prototype.handleImpression=function(t,e){var n=document.getElementById(t),r={transport:"beacon",eventCategory:"Viewport",eventAction:"impression",eventLabel:t,eventVisible:e},o=i({},this.opts.fieldsObj,c(n,this.opts.attributePrefix));this.tracker.send("event",a(r,o,this.tracker,this.opts.hitFilter,n))},e.prototype.possiblyUnobserveElement=function(t){this.itemsIncludesId(t)||(this.intersectionObserver.unobserve(this.elementMap[t]),delete this.elementMap[t])},e.prototype.handleDomElementRemoved=function(t){this.intersectionObserver.unobserve(this.elementMap[t]),this.elementMap[t]=null},e.prototype.itemsIncludesId=function(t){return this.items.some(function(e){return t==e.id})},e.prototype.remove=function(){this.mutationObserver.disconnect(),this.intersectionObserver.disconnect()},r("impressionTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],6:[function(t){function e(t,e){s.track(t,s.plugins.MEDIA_QUERY_TRACKER),window.matchMedia&&(this.opts=i({definitions:null,changeTemplate:this.changeTemplate,changeTimeout:1e3,fieldsObj:{},hitFilter:null},e),l(this.opts.definitions)&&(this.opts.definitions=u(this.opts.definitions),this.tracker=t,this.changeListeners=[],this.processMediaQueries()))}function n(t){return h[t]?h[t]:(h[t]=window.matchMedia(t),h[t])}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i=t("object-assign"),r=t("debounce"),o=t("../constants"),a=t("../provide"),s=t("../usage"),c=t("../utilities").createFieldsObj,l=t("../utilities").isObject,u=t("../utilities").toArray,h={};e.prototype.processMediaQueries=function(){this.opts.definitions.forEach(function(t){if(t.name&&t.dimensionIndex){var e=this.getMatchName(t);this.tracker.set("dimension"+t.dimensionIndex,e),this.addChangeListeners(t)}}.bind(this))},e.prototype.getMatchName=function(t){var e;return t.items.forEach(function(t){n(t.media).matches&&(e=t)}),e?e.name:o.NULL_DIMENSION},e.prototype.addChangeListeners=function(t){t.items.forEach(function(e){var i=n(e.media),o=r(function(){this.handleChanges(t)}.bind(this),this.opts.changeTimeout);i.addListener(o),this.changeListeners.push({mql:i,fn:o})}.bind(this))},e.prototype.handleChanges=function(t){var e=this.getMatchName(t),n=this.tracker.get("dimension"+t.dimensionIndex);if(e!==n){this.tracker.set("dimension"+t.dimensionIndex,e);var i={eventCategory:t.name,eventAction:"change",eventLabel:this.opts.changeTemplate(n,e)};this.tracker.send("event",c(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},e.prototype.remove=function(){for(var t,e=0;t=this.changeListeners[e];e++)t.mql.removeListener(t.fn)},e.prototype.changeTemplate=function(t,e){return t+" => "+e},a("mediaQueryTracker",e)},{"../constants":1,"../provide":12,"../usage":13,"../utilities":14,debounce:16,"object-assign":23}],7:[function(t){function e(t,e){a.track(t,a.plugins.OUTBOUND_FORM_TRACKER),window.addEventListener&&(this.opts=n({formSelector:"form",shouldTrackOutboundForm:this.shouldTrackOutboundForm,fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.delegate=i(document,"submit","form",this.handleFormSubmits.bind(this),{composed:!0,useCapture:!0}))}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("dom-utils/lib/delegate"),r=t("dom-utils/lib/parse-url"),o=t("../provide"),a=t("../usage"),s=t("../utilities").createFieldsObj,c=t("../utilities").getAttributeFields,l=t("../utilities").withTimeout;e.prototype.handleFormSubmits=function(t,e){var i=r(e.action).href,o={transport:"beacon",eventCategory:"Outbound Form",eventAction:"submit",eventLabel:i};if(this.opts.shouldTrackOutboundForm(e,r)){navigator.sendBeacon||(t.preventDefault(),o.hitCallback=l(function(){e.submit()}));var a=n({},this.opts.fieldsObj,c(e,this.opts.attributePrefix));this.tracker.send("event",s(o,a,this.tracker,this.opts.hitFilter,e))}},e.prototype.shouldTrackOutboundForm=function(t,e){var n=e(t.action);return n.hostname!=location.hostname&&"http"==n.protocol.slice(0,4)},e.prototype.remove=function(){this.delegate.destroy()},o("outboundFormTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"dom-utils/lib/parse-url":22,"object-assign":23}],8:[function(t){function e(t,e){a.track(t,a.plugins.OUTBOUND_LINK_TRACKER),window.addEventListener&&(this.opts=n({events:["click"],linkSelector:"a, area",shouldTrackOutboundLink:this.shouldTrackOutboundLink,fieldsObj:{},attributePrefix:"ga-",hitFilter:null},e),this.tracker=t,this.handleLinkInteractions=this.handleLinkInteractions.bind(this),this.delegates={},this.opts.events.forEach(function(t){this.delegates[t]=i(document,t,this.opts.linkSelector,this.handleLinkInteractions,{composed:!0,useCapture:!0})}.bind(this)))}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("dom-utils/lib/delegate"),r=t("dom-utils/lib/parse-url"),o=t("../provide"),a=t("../usage"),s=t("../utilities").createFieldsObj,c=t("../utilities").getAttributeFields;e.prototype.handleLinkInteractions=function(t,e){if(this.opts.shouldTrackOutboundLink(e,r)){navigator.sendBeacon||(e.target="_blank");var i=e.getAttribute("href")||e.getAttribute("xlink:href"),o=r(i),a={transport:"beacon",eventCategory:"Outbound Link",eventAction:t.type,eventLabel:o.href},l=n({},this.opts.fieldsObj,c(e,this.opts.attributePrefix));this.tracker.send("event",s(a,l,this.tracker,this.opts.hitFilter,e))}},e.prototype.shouldTrackOutboundLink=function(t,e){var n=t.getAttribute("href")||t.getAttribute("xlink:href"),i=e(n);return i.hostname!=location.hostname&&"http"==i.protocol.slice(0,4)},e.prototype.remove=function(){Object.keys(this.delegates).forEach(function(t){this.delegates[t].destroy()}.bind(this))},o("outboundLinkTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"dom-utils/lib/delegate":18,"dom-utils/lib/parse-url":22,"object-assign":23}],9:[function(t){function e(t,e){r.track(t,r.plugins.PAGE_VISIBILITY_TRACKER),window.addEventListener&&(this.opts=n({sessionTimeout:s,changeTemplate:this.changeTemplate,hiddenMetricIndex:null,visibleMetricIndex:null,fieldsObj:{},hitFilter:null},e),this.tracker=t,this.visibilityState=document.visibilityState,this.lastVisibilityChangeTime=+new Date,this.handleVisibilityStateChange=this.handleVisibilityStateChange.bind(this),this.overrideTrackerSendMethod(),this.overrideTrackerSendHitTask(),document.addEventListener("visibilitychange",this.handleVisibilityStateChange))}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("../provide"),r=t("../usage"),o=t("../utilities").createFieldsObj,a=t("../utilities").isObject,s=30;e.prototype.handleVisibilityStateChange=function(){var t;if(this.prevVisibilityState=this.visibilityState,this.visibilityState=document.visibilityState,this.sessionHasTimedOut()){if("hidden"==this.visibilityState)return;"visible"==this.visibilityState&&(t={transport:"beacon"},this.tracker.send("pageview",o(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter)))}else{var e=Math.round((new Date-this.lastVisibilityChangeTime)/1e3)||1;t={transport:"beacon",eventCategory:"Page Visibility",eventAction:"change",eventLabel:this.opts.changeTemplate(this.prevVisibilityState,this.visibilityState),eventValue:e},"hidden"==this.visibilityState&&(t.nonInteraction=!0);var n=this.opts[this.prevVisibilityState+"MetricIndex"];n&&(t["metric"+n]=e),this.tracker.send("event",o(t,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}this.lastVisibilityChangeTime=+new Date},e.prototype.sessionHasTimedOut=function(){var t=(new Date-this.lastHitTime)/6e4;return this.opts.sessionTimeout<t},e.prototype.overrideTrackerSendMethod=function(){this.originalTrackerSendMethod=this.tracker.send,this.tracker.send=function(){var t=Array.prototype.slice.call(arguments),e=t[0],n=a(e)?e.hitType:e,i="pageview"==n;if(!i&&this.sessionHasTimedOut()){var r={transport:"beacon"};this.originalTrackerSendMethod.call(this.tracker,"pageview",o(r,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}this.originalTrackerSendMethod.apply(this.tracker,t)}.bind(this)},e.prototype.overrideTrackerSendHitTask=function(){this.originalTrackerSendHitTask=this.tracker.get("sendHitTask"),this.lastHitTime=+new Date,this.tracker.set("sendHitTask",function(t){this.originalTrackerSendHitTask(t),this.lastHitTime=+new Date}.bind(this))},e.prototype.changeTemplate=function(t,e){return t+" => "+e},e.prototype.remove=function(){this.tracker.set("sendHitTask",this.originalTrackerSendHitTask),this.tracker.send=this.originalTrackerSendMethod,document.removeEventListener("visibilitychange",this.handleVisibilityStateChange)},i("pageVisibilityTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],10:[function(t){function e(t,e){r.track(t,r.plugins.SOCIAL_WIDGET_TRACKER),window.addEventListener&&(this.opts=n({fieldsObj:{},hitFilter:null},e),this.tracker=t,this.addWidgetListeners=this.addWidgetListeners.bind(this),this.addTwitterEventHandlers=this.addTwitterEventHandlers.bind(this),this.handleTweetEvents=this.handleTweetEvents.bind(this),this.handleFollowEvents=this.handleFollowEvents.bind(this),this.handleLikeEvents=this.handleLikeEvents.bind(this),this.handleUnlikeEvents=this.handleUnlikeEvents.bind(this),"complete"!=document.readyState?window.addEventListener("load",this.addWidgetListeners):this.addWidgetListeners())}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("../provide"),r=t("../usage"),o=t("../utilities").createFieldsObj;e.prototype.addWidgetListeners=function(){window.FB&&this.addFacebookEventHandlers(),window.twttr&&this.addTwitterEventHandlers()},e.prototype.addTwitterEventHandlers=function(){try{twttr.ready(function(){twttr.events.bind("tweet",this.handleTweetEvents),twttr.events.bind("follow",this.handleFollowEvents)}.bind(this))}catch(t){}},e.prototype.removeTwitterEventHandlers=function(){try{twttr.ready(function(){twttr.events.unbind("tweet",this.handleTweetEvents),twttr.events.unbind("follow",this.handleFollowEvents)}.bind(this))}catch(t){}},e.prototype.addFacebookEventHandlers=function(){try{FB.Event.subscribe("edge.create",this.handleLikeEvents),FB.Event.subscribe("edge.remove",this.handleUnlikeEvents)}catch(t){}},e.prototype.removeFacebookEventHandlers=function(){try{FB.Event.unsubscribe("edge.create",this.handleLikeEvents),FB.Event.unsubscribe("edge.remove",this.handleUnlikeEvents)}catch(t){}},e.prototype.handleTweetEvents=function(t){if("tweet"==t.region){var e=t.data.url||t.target.getAttribute("data-url")||location.href,n={transport:"beacon",socialNetwork:"Twitter",socialAction:"tweet",socialTarget:e};this.tracker.send("social",o(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},e.prototype.handleFollowEvents=function(t){if("follow"==t.region){var e=t.data.screen_name||t.target.getAttribute("data-screen-name"),n={transport:"beacon",socialNetwork:"Twitter",socialAction:"follow",socialTarget:e};this.tracker.send("social",o(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}},e.prototype.handleLikeEvents=function(t){var e={transport:"beacon",socialNetwork:"Facebook",socialAction:"like",socialTarget:t};this.tracker.send("social",o(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))},e.prototype.handleUnlikeEvents=function(t){var e={transport:"beacon",socialNetwork:"Facebook",socialAction:"unlike",socialTarget:t};this.tracker.send("social",o(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))},e.prototype.remove=function(){window.removeEventListener("load",this.addWidgetListeners),this.removeFacebookEventHandlers(),this.removeTwitterEventHandlers()},i("socialWidgetTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],11:[function(t){function e(t,e){o.track(t,o.plugins.URL_CHANGE_TRACKER),history.pushState&&window.addEventListener&&(this.opts=i({shouldTrackUrlChange:this.shouldTrackUrlChange,fieldsObj:{},hitFilter:null},e),this.tracker=t,this.path=n(),this.updateTrackerData=this.updateTrackerData.bind(this),this.originalPushState=history.pushState,history.pushState=function(t,e){s(t)&&e&&(t.title=e),this.originalPushState.apply(history,arguments),this.updateTrackerData()}.bind(this),this.originalReplaceState=history.replaceState,history.replaceState=function(t,e){s(t)&&e&&(t.title=e),this.originalReplaceState.apply(history,arguments),this.updateTrackerData(!1)}.bind(this),window.addEventListener("popstate",this.updateTrackerData))}function n(){return location.pathname+location.search}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var i=t("object-assign"),r=t("../provide"),o=t("../usage"),a=t("../utilities").createFieldsObj,s=t("../utilities").isObject;e.prototype.updateTrackerData=function(t){t=t===!1?!1:!0,setTimeout(function(){var e=this.path,i=n();if(e!=i&&this.opts.shouldTrackUrlChange.call(this,i,e)&&(this.path=i,this.tracker.set({page:i,title:s(history.state)&&history.state.title||document.title}),t)){var r={transport:"beacon"};this.tracker.send("pageview",a(r,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}.bind(this),0)},e.prototype.shouldTrackUrlChange=function(t,e){return t&&e},e.prototype.remove=function(){window.removeEventListener("popstate",this.updateTrackerData),history.replaceState=this.originalReplaceState,history.pushState=this.originalPushState,this.tracker=null,this.opts=null,this.path=null,this.updateTrackerData=null,this.originalReplaceState=null,this.originalPushState=null},r("urlChangeTracker",e)},{"../provide":12,"../usage":13,"../utilities":14,"object-assign":23}],12:[function(t,e){/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("./constants"),i=t("./utilities");(window.gaDevIds=window.gaDevIds||[]).push(n.DEV_ID),e.exports=function(t,e){var n=window.GoogleAnalyticsObject||"ga";window[n]=window[n]||function(){(window[n].q=window[n].q||[]).push(arguments)},window[n]("provide",t,e),window.gaplugins=window.gaplugins||{},window.gaplugins[i.capitalize(t)]=e}},{"./constants":1,"./utilities":14}],13:[function(t,e){function n(t){return parseInt(t||"0",16).toString(2)}function i(t){return parseInt(t||"0",2).toString(16)}function r(t,e){if(t.length<e)for(var n=e-t.length;n;)t="0"+t,n--;return t}function o(t,e){return t.substr(0,e)+1+t.substr(e+1)}function a(t,e){var a=t.get(c.USAGE_PARAM),s=r(n(a),u);s=o(s,u-e),t.set(c.USAGE_PARAM,i(s))}function s(t){t.set(c.VERSION_PARAM,c.VERSION)}/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var c=t("./constants"),l={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9},u=9;e.exports={track:function(t,e){s(t),a(t,e)},plugins:l}},{"./constants":1}],14:[function(t,e){/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var n=t("object-assign"),i=t("dom-utils/lib/get-attributes"),r={createFieldsObj:function(t,e,i,r,o){if("function"==typeof r){var a=i.get("buildHitTask");return{buildHitTask:function(n){n.set(t,null,!0),n.set(e,null,!0),r(n,o),a(n)}}}return n({},t,e)},getAttributeFields:function(t,e){var n=i(t),o={};return Object.keys(n).forEach(function(t){if(0===t.indexOf(e)&&t!=e+"on"){var i=n[t];"true"==i&&(i=!0),"false"==i&&(i=!1);var a=r.camelCase(t.slice(e.length));o[a]=i}}),o},domReady:function(t){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e),t()}):t()},withTimeout:function(t,e){var n=!1;return setTimeout(t,e||2e3),function(){n||(n=!0,t())}},camelCase:function(t){return t.replace(/[\-\_]+(\w?)/g,function(t,e){return e.toUpperCase()})},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},isObject:function(t){return"object"==typeof t&&null!==t},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},toArray:function(t){return r.isArray(t)?t:[t]}};e.exports=r},{"dom-utils/lib/get-attributes":19,"object-assign":23}],15:[function(t,e){function n(){return(new Date).getTime()}e.exports=Date.now||n},{}],16:[function(t,e){var n=t("date-now");e.exports=function(t,e,i){function r(){var u=n()-c;e>u&&u>0?o=setTimeout(r,e-u):(o=null,i||(l=t.apply(s,a),o||(s=a=null)))}var o,a,s,c,l;return null==e&&(e=100),function(){s=this,a=arguments,c=n();var u=i&&!o;return o||(o=setTimeout(r,e)),u&&(l=t.apply(s,a),s=a=null),l}}},{"date-now":15}],17:[function(t,e){var n=t("./matches"),i=t("./parents");e.exports=function(t,e,r){if(t&&1==t.nodeType&&e)for(var o,a=(r?[t]:[]).concat(i(t)),s=0;o=a[s];s++)if(n(o,e))return o}},{"./matches":20,"./parents":21}],18:[function(t,e){var n=t("./closest"),i=t("./matches");e.exports=function(t,e,r,o,a){a=a||{};var s=function(t){if(a.composed&&"function"==typeof t.composedPath)for(var e,s=t.composedPath(),c=0;e=s[c];c++)1==e.nodeType&&i(e,r)&&(l=e);else var l=n(t.target,r,!0);l&&o.call(l,t,l)};return t.addEventListener(e,s,a.useCapture),{destroy:function(){t.removeEventListener(e,s,a.useCapture)}}}},{"./closest":17,"./matches":20}],19:[function(t,e){e.exports=function(t){var e={};if(!t||1!=t.nodeType)return e;var n=t.attributes;if(0===n.length)return{};for(var i,r=0;i=n[r];r++)e[i.name]=i.value;return e}},{}],20:[function(t,e){function n(t,e){if("string"!=typeof e)return!1;if(r)return r.call(t,e);for(var n,i=t.parentNode.querySelectorAll(e),o=0;n=i[o];o++)if(n==t)return!0;return!1}var i=window.Element.prototype,r=i.matches||i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;e.exports=function(t,e){if(t&&1==t.nodeType&&e){if("string"==typeof e||1==e.nodeType)return t==e||n(t,e);if("length"in e)for(var i,r=0;i=e[r];r++)if(t==i||n(t,i))return!0}return!1}},{}],21:[function(t,e){e.exports=function(t){for(var e=[];t&&t.parentNode&&1==t.parentNode.nodeType;)e.push(t=t.parentNode);return e}},{}],22:[function(t,e){var n="80",i="443",r=RegExp(":("+n+"|"+i+")$"),o=document.createElement("a"),a={};e.exports=function s(t){if(t=t&&"."!=t?t:location.href,a[t])return a[t];if(o.href=t,"."==t.charAt(0))return s(o.href);var e=o.protocol&&":"!=o.protocol?o.protocol:location.protocol,c=o.port==n||o.port==i?"":o.port;c="0"==c?"":c;var l=""==o.host?location.host:o.host,u=""==o.hostname?location.hostname:o.hostname;l=l.replace(r,"");var h=o.origin?o.origin:e+"//"+l,d="/"==o.pathname.charAt(0)?o.pathname:"/"+o.pathname;return a[t]={hash:o.hash,host:l,hostname:u,href:o.href,origin:h,pathname:d,port:c,protocol:e,search:o.search,fragment:o.hash.slice(1),path:d+o.search,query:o.search.slice(1)}}},{}],23:[function(t,e){"use strict";function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function i(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;10>n;n++)e["_"+String.fromCharCode(n)]=n;var i=Object.getOwnPropertyNames(e).map(function(t){return e[t]});if("0123456789"!==i.join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},r)).join("")?!1:!0}catch(o){return!1}}var r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=i()?Object.assign:function(t){for(var e,i,a=n(t),s=1;s<arguments.length;s++){e=Object(arguments[s]);for(var c in e)r.call(e,c)&&(a[c]=e[c]);if(Object.getOwnPropertySymbols){i=Object.getOwnPropertySymbols(e);for(var l=0;l<i.length;l++)o.call(e,i[l])&&(a[i[l]]=e[i[l]])}}return a}},{}],24:[function(t){/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
t("./plugins/clean-url-tracker"),t("./plugins/event-tracker"),t("./plugins/impression-tracker"),t("./plugins/media-query-tracker"),t("./plugins/outbound-form-tracker"),t("./plugins/outbound-link-tracker"),t("./plugins/page-visibility-tracker"),t("./plugins/social-widget-tracker"),t("./plugins/url-change-tracker"),t("./plugins/autotrack")},{"./plugins/autotrack":2,"./plugins/clean-url-tracker":3,"./plugins/event-tracker":4,"./plugins/impression-tracker":5,"./plugins/media-query-tracker":6,"./plugins/outbound-form-tracker":7,"./plugins/outbound-link-tracker":8,"./plugins/page-visibility-tracker":9,"./plugins/social-widget-tracker":10,"./plugins/url-change-tracker":11}]},{},[24]),/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){function n(t){this.time=t.time,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect,this.target=t.target;var e=this.boundingClientRect,n=e.width*e.height,i=this.intersectionRect,r=i.width*i.height;this.intersectionRatio=n?r/n:0}function i(t,e){var n=e||{};if("function"!=typeof t)throw new Error("callback must be a function");if(n.root&&1!=n.root.nodeType)throw new Error("root must be an Element");this._checkForIntersections=o(this._checkForIntersections.bind(this),this.THROTTLE_TIMEOUT),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(n.rootMargin),this.thresholds=this._initThresholds(n.threshold),this.root=n.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit}).join(" ")}function r(){return t.performance&&performance.now&&performance.now()}function o(t,e){var n=null;return function(){n||(n=setTimeout(function(){t(),n=null},e))}}function a(t,e,n,i){"function"==typeof t.addEventListener?t.addEventListener(e,n,i||!1):"function"==typeof t.attachEvent&&t.attachEvent(e,n)}function s(t,e,n,i){"function"==typeof t.removeEventListener?t.addEventListener(e,n,i||!1):"function"==typeof t.detatchEvent&&t.detatchEvent(e,n)}function c(t,e){var n=Math.max(t.top,e.top),i=Math.min(t.bottom,e.bottom),r=Math.max(t.left,e.left),o=Math.min(t.right,e.right),a=o-r,s=i-n;return 0>a||0>s?h():{top:n,bottom:i,left:r,right:o,width:a,height:s}}function l(t){return t.top>0||t.bottom>0||t.left>0||t.right>0}function u(t){var e=t.getBoundingClientRect();if(e)return e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e}function h(){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}function d(t,e){for(var n=e.parentNode;n;){if(t==n)return!0;n=n.parentNode}}function p(t){return"[object Array]"==Object.prototype.toString.call(t)}if(!("IntersectionObserver"in t&&"IntersectionObserverEntry"in t&&"intersectionRatio"in t.IntersectionObserverEntry.prototype)){var m=[];i.prototype.THROTTLE_TIMEOUT=100,i.prototype.POLL_INTERVAL=null,i.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t})){if(!t||1!=t.nodeType)throw new Error("target must be an Element");this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections()}},i.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance())},i.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance()},i.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t},i.prototype._initThresholds=function(t){var e=t||[0];return p(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||0>t||t>1)throw new Error("threshold must be a number between 0 and 1 inclusively");return t!==n[e-1]})},i.prototype._parseRootMargin=function(t){var e=t||"0px",n=e.split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e)throw new Error("rootMargin must be specified in pixels or percent");return{value:parseFloat(e[1]),unit:e[2]}});return n[1]=n[1]||n[0],n[2]=n[2]||n[0],n[3]=n[3]||n[1],n},i.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this._checkForIntersections(),this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(a(t,"resize",this._checkForIntersections,!0),a(e,"scroll",this._checkForIntersections,!0),"MutationObserver"in t&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))))},i.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,s(t,"resize",this._checkForIntersections,!0),s(e,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null))},i.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():h();this._observationTargets.forEach(function(i){var o=i.element,a=u(o),s=this._rootContainsTarget(o),c=i.entry,d=i.entry=new n({time:r(),target:o,boundingClientRect:a,rootBounds:e,intersectionRect:t&&s?this._computeTargetAndRootIntersection(o,e):h()});t&&s?this._hasCrossedThreshold(c,d)&&this._queuedEntries.push(d):c&&l(c.intersectionRect)&&this._queuedEntries.push(d)}.bind(this)),this._queuedEntries.length&&this._callback(this.takeRecords(),this)},i.prototype._computeTargetAndRootIntersection=function(e,n){for(var i=u(e),r=i,o=e.parentNode,a=!1;!a;){var s=null;if(o==this.root||1!=o.nodeType)a=!0,s=n;else{var h=t.getComputedStyle(o);"visible"!=h.overflow&&(s=u(o))}if(s&&(r=c(s,r),!l(r)))break;o=o.parentNode}return r},i.prototype._getRootRect=function(){var t;if(this.root)t=u(this.root);else{var n=e.documentElement,i=e.body;t={top:0,left:0,right:n.clientWidth||i.clientWidth,width:n.clientWidth||i.clientWidth,bottom:n.clientHeight||i.clientHeight,height:n.clientHeight||i.clientHeight}}return this._expandRectByRootMargin(t)},i.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n},i.prototype._hasCrossedThreshold=function(t,e){var n=t&&l(t.intersectionRect)?t.intersectionRatio||0:-1,i=l(e.intersectionRect)?e.intersectionRatio||0:-1;if(n!==i)for(var r=0;r<this.thresholds.length;r++){var o=this.thresholds[r];if(o==n||o==i||n>o!=i>o)return!0}},i.prototype._rootIsInDom=function(){return!this.root||d(e,this.root)},i.prototype._rootContainsTarget=function(t){return d(this.root||e,t)},i.prototype._registerInstance=function(){m.indexOf(this)<0&&m.push(this)},i.prototype._unregisterInstance=function(){m=m.filter(function(t){return t!==this}.bind(this))},t.IntersectionObserver=i,t.IntersectionObserverEntry=n}}(window,document),function(){Strava.module("Strava.Util"),Strava.Util.ClioAdapter=function(){function t(t){this.clioClient=t,this.loggingEnabled=!1}return t.prototype.trackClick=function(t,e,n){var i,r,o;return this.log("%ctrackClick %O",arguments,"color: blue; font-size: large;"),r="kudos"===e?Strava.Analytics.Models.ClientEvent.newKudo(t):"comment"===e?Strava.Analytics.Models.ClientEvent.newComment(t):(o=Strava.Analytics.Models.ClientEvent.TargetType,i=function(){switch(e){case"self":return o.SELF;case"link":return o.LINK;case"photo":return o.PHOTO;case"avatar":return o.OWNER_AVATAR;case"name":return o.OWNER_NAME;case"map":return o.MAP;case"comment_list":return o.COMMENT_LIST;case"share":return o.SHARE;case"join":return o.JOIN;case"perk":return o.PREMIUM_PERK;case"partner_link":return o.PARTNER_LINK;default:return o.SELF}}(),Strava.Analytics.Models.ClientEvent.newClick(t).setTargetType(i)),n&&r.setTargetUrl(n),this.track(r)},t.prototype.trackScreenExit=function(t){return this.log("%ctrackScreenExit %O",arguments,"color: red; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenExit(t))},t.prototype.trackScreenEnter=function(t){return this.log("%ctrackScreenEnter %O",arguments,"color: green; font-size: large;"),this.track(Strava.Analytics.Models.ClientEvent.newScreenEnter(t))},t.prototype.log=function(t,e,n){return this.loggingEnabled?console.log(t,n,e):void 0},t.prototype.track=function(t){return t.setClientUrl(window.location.href),this.clioClient.track(t)},t}()}.call(this),function(){Strava.module("Strava.Tracking"),Strava.Tracking.ImpressionTrackerSet=function(){function t(){this.trackers={}}return t.prototype.addTracker=function(t,e){return this.trackers[t]?void 0:this.trackers[t]={tracker:t,ga:e}},t.prototype.pageEnter=function(){var t,e,n,i;n=this.trackers,i=[];for(e in n)t=n[e],i.push(t.tracker.pageEnter());return i},t.prototype.pageExit=function(){var t,e,n,i;n=this.trackers,i=[];for(e in n)t=n[e],i.push(t.tracker.pageExit());return i},t.prototype.hide=function(){var t,e,n,i;n=this.trackers,i=[];for(e in n)t=n[e],i.push(t.tracker.hide());return i},t.prototype.show=function(){var t,e,n,i;n=this.trackers,i=[];for(e in n)t=n[e],i.push(t.tracker.show());return i},t.prototype.count=function(){return Object.keys(this.trackers).length},t.prototype.reset=function(){var t,e,n;n=this.trackers;for(e in n)t=n[e],t.tracker.pageExit(),t.ga.remove();return this.trackers={}},t}()}.call(this),function(){Strava.module("Strava.Util"),Strava.Util.Autotrack=function(){function t(){this.impressionTrackerSet=new Strava.Tracking.ImpressionTrackerSet,this.pageVisibilityTracker=null}var e,n;return e=1440,t.prototype.setPageVisibilityTracker=function(t){return this.pageVisibilityTracker=t,this.pageVisibilityTracker.on("pageEnter",function(t){return function(){return t.impressionTrackerSet.pageEnter()}}(this)),this.pageVisibilityTracker.on("pageExit",function(t){return function(){return t.impressionTrackerSet.pageExit()}}(this))},t.prototype.addImpressionTracker=function(t,e){return this.impressionTrackerSet.addTracker(t,e)},t.prototype.setClioTracker=function(t){return this.clioTracker=t},t.prototype.getClioTracker=function(){return this.clioTracker},t.prototype.handleUnload=function(){return this.impressionTrackerSet.pageExit()},t.prototype.handleImpressionReset=function(){return this.impressionTrackerSet.reset()},t.prototype.handleImpressionHide=function(){return this.impressionTrackerSet.hide()},t.prototype.handleImpressionShow=function(){return this.impressionTrackerSet.show()},t.prototype.handleImpressionAppend=function(t){return Strava.Feed.ImpressionTracker.configure(t,this.clioTracker)},n=null,t.getInstance=function(){return n||(n=new this),n},t.configureImpressionTracker=function(t){var e;return e=this.createPlugin("ImpressionTracker",t,{attributePrefix:"str-",elements:t.entities()}),this.getInstance().addImpressionTracker(t,e)},t.configurePageVisibilityTracker=function(t){return this.createPlugin("PageVisibilityTracker",t,{changeTemplate:function(t,e){return e},sessionTimeout:e}),this.getInstance().setPageVisibilityTracker(t)},t.configureEventTracker=function(t){return this.createPlugin("EventTracker",t,{attributePrefix:"str-"})},t.createPlugin=function(t,e,n){return"undefined"!=typeof gaplugins&&null!==gaplugins?new gaplugins[t](e,n):(console.log("gaplugins not found"),null)},t.configurePage=function(t,e,n){var i,r;return i={remote_logger:{request_headers:{"X-CSRF-Token":t}}},r=this.getInstance(),Strava.Analytics.initialize(e,i).then(function(t){var e;return e=new Strava.Util.ClioAdapter(t),r.setClioTracker(e),n(e,r)})},t.configureMore=function(t){var e;return e=this.getInstance(),t(e.getClioTracker())},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.EventTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(t,e){return this.clioClient=e.clioClient},n.prototype.send=function(t,e){return"anchor_container"===e.type?this.handleAnchorContainer(t,e):this.clioClient.trackClick(e.trackableId,e.type,e.targetUrl)},n.prototype.handleAnchorContainer=function(t,e){var n;if("A"===e.targetTagName)return n=e.click_type?e.click_type:"link",this.clioClient.trackClick(e.trackableId,n,e.targetUrl)},n.configure=function(t){var e;return e=new this({},{clioClient:t}),Strava.Util.Autotrack.configureEventTracker(e)},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["performance_goals/tooltip"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='dismiss' href='javascript:;'>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.dismiss")))),n.push("</a>\n<h4 class='h5 title'>\n  <div class='badge premium sm'></div>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.goals")))),n.push("</h4>\n<div class='content'>"),n.push("  "+t(Strava.I18n.Locale.t("templates.performance_goals.tooltip.upsell_html"))),n.push("</div>\n<div class='arrow bottom'></div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TooltipView=function(e){function n(t){n.__super__.constructor.call(this),JST[t]?this.template=t:this.createTemplate(t)}return t(n,e),n.prototype.tagName="div",n.prototype.className="super-tooltip",n.prototype.attributes={style:"display: none"},n.prototype.events={"click .dismiss":"dismissTooltip"},n.prototype.render=function(t,e){return this.renderTemplate({data:this.prepareData(t)}),this.delegateEvents(),this.show(e),this},n.prototype.prepareData=function(t){return t},n.prototype.show=function(t){var e,n,i,r,o,a;return this.$$(".super-tooltip").remove(),this.$$("body").append(this.el),n=this.$$(t),a=n.offset(),e=this.$("div.arrow"),r=e.hasClass("top")?a.top+n.outerHeight()+10:a.top-(this.$el.height()+15),o=!1,0>r?(r=0,o=!0):r+this.$el.outerHeight()>this.$$(window).height()+window.pageYOffset&&(r=this.$$(window).height()+window.pageYOffset-this.$el.outerHeight(),o=!0),i=a.left-this.$el.width()/2+n.outerWidth()/2,0>i?(i=0,o=!0):i+this.$el.outerWidth()>this.$$(window).width()+window.pageXOffset&&(i=this.$$(window).width()+window.pageXOffset-this.$el.outerWidth(),o=!0),o&&e.hide(),this.$el.css({left:i,top:r}),this.$el.fadeIn("fast")},n.prototype.dismissTooltip=function(){return this.$el.remove(),!1},n.createInstance=function(t,e){return null==this.instance&&(this.instance=new e(t),this.instance.$document().click(function(t){return function(e){return t.instance.$el.is(":visible")&&!jQuery(e.target).parents(".super-tooltip").length?t.instance.dismissTooltip():void 0}}(this))),this.instance},n.show=function(t,e){return this.instance.render(t,e)},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/goal_tooltip"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='dismiss'>"+e(t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.dismiss")))+"</a>\n<h4 class='h5 title'>\n  <div class='badge premium sm'></div>"),n.push("  "+e(t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.title")))),n.push("</h4>\n<div class='content'>"),n.push("  "+t(Strava.I18n.Locale.t("templates.feed.goal_tooltip.upgrade_html",{url:"/premium/?source=progress-goals#goals"}))),n.push("</div>\n<div class='arrow bottom'></div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GoalTooltipView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.prepareData=function(t){return{name:t.athlete_firstname}},n.createInstance=function(){return Strava.Ui.TooltipView.createInstance("feed/goal_tooltip",this)},n.show=function(t,e){return Strava.Ui.TooltipView.show(t,e)},n}(Strava.Ui.TooltipView)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GroupRideController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.fetchGroupAthletes=function(t,e,n,i){return this.fetch({url:Strava.Lib.EntityMap.getUrl(t,e,"group_athletes"),success:function(t,e){return n(e.athletes)},error:function(){return i("")}})},n.prototype.parse=function(){return{id:1}},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/group_ride"]=function(t){return function(){var t;return t=[],t.push("<ul class='athletes list-athletes list-media'></ul>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.GroupRideView=function(e){function n(t,e,i,r){this.controller=t,this.entity=e,this.entityId=i,this.activityAthlete=r,this.loadingTemplate="feed/loading_box",this.groupTemplate="feed/group_ride",n.__super__.constructor.call(this)}return t(n,e),n.prototype.render=function(t){return this.setElement(t),this.renderTemplate({},this.loadingTemplate),this.controller.fetchGroupAthletes(this.entity,this.entityId,function(t){return function(e){return t.handleSuccess(e)}}(this),function(t){return function(e){return t.handleError(e)}}(this)),this},n.prototype.handleSuccess=function(t){var e,n,i,r;if(!this.selected)return this;for(this.renderTemplate({},this.groupTemplate),n=[],i=0,r=t.length;r>i;i++)e=t[i],n.push(this.createAthleteElem(e));return n.length&&this.$("ul.athletes").append(n).find("li").fadeIn("fast"),this},n.prototype.handleError=function(){},n.prototype.createAthleteElem=function(t){var e;return e=new Strava.AthleteListView(t,this.entityId,this.activityAthlete),e.render().el},n.prototype.unselect=function(){return this.selected=!1},n.prototype.select=function(){return this.selected=!0},n.prototype.show=function(){},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.ImpressionTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var i;return t(n,e),n.prototype.initialize=function(t,e){return this.clioClient=e.clioClient,this.entityStates={},this.id=i()},n.prototype.toString=function(){return"<ImpressionTracker"+this.id+">"},n.prototype.entities=function(){var t,e,n,i,r,o;for(o=this.get("impressionThreshold"),i=this.get("entityIds"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push({trackFirstImpressionOnly:!1,threshold:o,id:t});return r},n.prototype.send=function(t,e){var n;return n=e.eventVisible,n?(this.entityStates[e.trackableId]="enter",this.clioClient.trackScreenEnter(e.trackableId)):(this.entityStates[e.trackableId]="exit",this.clioClient.trackScreenExit(e.trackableId))},n.prototype.pageEnter=function(){var t,e,n,i;t=this.entityStates,e=[];for(i in t)n=t[i],"enter"===n&&e.push(this.clioClient.trackScreenEnter(i));return e},n.prototype.pageExit=function(){var t,e,n,i;t=this.entityStates,e=[];for(i in t)n=t[i],"enter"===n&&e.push(this.clioClient.trackScreenExit(i));return e},n.prototype.hide=function(){var t,e,n,i;t=this.entityStates,e=[];for(i in t)n=t[i],"enter"===n&&(this.entityStates[i]="hide",e.push(this.clioClient.trackScreenExit(i)));return e},n.prototype.show=function(){var t,e,n,i;t=this.entityStates,e=[];for(i in t)n=t[i],"hide"===n&&(this.entityStates[i]="enter",e.push(this.clioClient.trackScreenEnter(i)));return e},i=function(){return Math.floor(1e4*Math.random()+1)},n.configure=function(t,e,n){var i;return null==n&&(n=.5),i=new this({entityIds:t,impressionThreshold:n},{clioClient:e}),Strava.Util.Autotrack.configureImpressionTracker(i),i},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Cohort=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.deferred=null},n.prototype.url=function(){return"/athlete/experiments/"+this.id+"/cohort"},n.prototype.cohort=function(){return this.deferred||(this.deferred=this.save()),this.deferred},n}(Backbone.Model)}.call(this),Strava.module("Strava"),Strava.Experiments=function(){var t={};return{cohort:function(e){return t[e]||(t[e]=new Strava.Models.Cohort({id:e})),t[e].cohort()}}}(),function(){null==window.JST&&(window.JST={}),window.JST["feed/kudo_box_layout"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<ul class='list-athletes list-kudos' id='kudo-list'></ul>\n<div class='actions actions-kudo modal-footer' style='display: none;'>\n  <button class='btn btn-default compact create-kudo' disabled='disabled'>"),n.push("    "+e(t(Strava.I18n.Locale.t("templates.feed.kudo_box_layout.give_kudos")))),n.push("  </button>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/kudo_current_athlete"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<li class='current-athlete'>\n  <a class='avatar avatar-athlete avatar-sm' href='/athletes/"+e(t(this.athlete.id))+"' title='"+e(t(this.athlete.display_name))+"'>\n    <img class='avatar-img' src='"+e(t(this.athlete.photo))+"' alt='"+e(t(this.athlete.display_name))+"' title='"+e(t(this.athlete.display_name))+"'>\n  </a>\n  <span class='name'>\n    <a class='athlete-name minimal' href='/athletes/"+e(t(this.athlete.id))+"'>"),n.push("      "+e(t(this.athlete.display_name))),this.athlete.member_type&&n.push("      <div class='app-icon-wrapper'>\n        <div class='"+["app-icon","icon-sm","icon-badge-"+e(t(this.athlete.member_type))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' title='"+e(t(Strava.I18n.Locale.t("templates.athletes.member_types."+this.athlete.member_type)))+"'></div>\n      </div>"),n.push("    </a>\n  </span>\n  <span class='location'>"+e(t(this.athlete.display_location))+"</span>\n</li>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/no_kudos"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<p class='no-kudos'>"+e(t(Strava.I18n.Locale.t("templates.feed.no_kudos.no_kudos_yet_v2")))+"</p>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.KudoBoxView=function(e){function n(t,e,i){this.controller=t,this.entity=e,this.entity_id=i,this.kudoTemplate="feed/kudo_box_layout",this.noKudosTemplate="feed/no_kudos",this.currentAthleteTemplate="feed/kudo_current_athlete",this.controller.bind("kudoCreated",function(t){return function(){return t.handleKudoCreate()}}(this)),n.__super__.constructor.call(this)}return t(n,e),n.prototype.events={'click .create-kudo:not([disabled="disabled"])':"createKudo"},n.prototype.render=function(t){return this.setElement(t),this.renderLoading(),this.controller.fetchKudos(this.entity,this.entity_id,function(t){return function(e,n,i){return t.handleSuccess(e,n,i)}}(this),function(t){return function(e){return t.handleError(e)}}(this)),this},n.prototype.handleSuccess=function(t,e,n){var i,r,o,a;if(!this.selected)return this;for(this.renderTemplate({},this.kudoTemplate),i=[],r=0,a=t.length;a>r;r++)o=t[r],i.push(this.createAthleteElem(o));return i.length?this.$("#kudo-list").append(i).find("li").fadeIn("fast"):this.handleEmptyList(),n||this.$(".actions").slideDown("fast"),e&&this.$(".create-kudo").removeAttr("disabled"),Strava.Experiments.cohort("web-kudos-lightbox-follow-button").done(function(t){return function(e){return t.handleSegmentTracking(e),"Variant B"===e.cohort?t.$(".action-buttons").css("opacity",1):void 0}}(this)).fail(function(t){return function(){return t.handleSegmentTracking("failed_to_cohort")}}(this)),this},n.prototype.handleEmptyList=function(){var t;return t=this.getTemplateFor(this.noKudosTemplate),this.$("#kudo-list").closest("#tab-contents").prepend(t({}))},n.prototype.handleError=function(){},n.prototype.createKudo=function(){return this.controller.kudo(this.entity,this.entity_id),!1},n.prototype.handleKudoCreate=function(){var t,e;if(this.selected)return t=this.$("#kudo-list"),e=this.getTemplateFor(this.currentAthleteTemplate),t.append(e({athlete:currentAthlete.toJSON()})),this.$(".no-kudos").remove(),this.$("button.create-kudo").addClass("kudoed").attr("disabled","disabled")},n.prototype.createAthleteElem=function(t){var e;return e=new Strava.AthleteListView(t),e.render().el},n.prototype.handleSegmentTracking=function(t){return Strava.SegmentIO.track("Kudos Show",{experiment_name:t.experiment_name,cohort:t.cohort,view_source:"lightbox",entity:this.entity,entity_id:this.entity_id}),this.$("#kudo-list").find(".follow-action a").each(function(e){return function(n,i){var r;return r=e.$(i),e.addFollowActionTracking(r,t,r.data("state"),r.parent().data("athlete-id"))}}(this)),this.$("#kudo-list").on("followActionChanged",".follow-action",function(e){return function(n){var i;return i=e.$(n.target).find("a"),e.addFollowActionTracking(i,t,i.data("state"),i.parent().data("athlete-id"))}}(this))},n.prototype.addFollowActionTracking=function(t,e,n,i){return Strava.SegmentIO.trackLink(t,"Athlete Follow",{experiment_name:e.experiment_name,cohort:e.cohort,athlete_id:i,action:n})},n}(Strava.Feed.SocialBoxView)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.MiniFeedController=function(e){function n(t,e,n){this.currentAthlete=t,this.websocketUrl=e,this.view=n,this.view.bind("open",function(t){return function(){return t.startWebsocket()}}(this))}return t(n,e),n.prototype.startWebsocket=function(){return this.ws?void 0:(this.ws=new WebSocket(this.websocketUrl),this.ws.onmessage=function(t){return function(e){var n;return n=JSON.parse(e.data),"clock"!==n.eventType?t.view.addEntry(n):void 0}}(this),this.ws.onclose=function(t){return function(){return setTimeout(function(){return t.ws=null,t.startWebsocket()},1e4)}}(this))},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["minifeed/comment_entry"]=function(t){return function(){var t,e,n,i,r;return e=window.HAML.escape,t=window.HAML.cleanValue,r=function(t){return function(e,n,i){return window.HAML.surround.call(t,e,n,i)}}(this),n=[],i=this.event.activity.athlete.annotation.firstName+" "+this.event.activity.athlete.annotation.lastName,n.push("<a class='avatar avatar-athlete avatar-default'>\n  <img src='"+e(t(this.avatar))+"'>\n</a>\n<div class='content'>\n  <a class='entry-athlete' href='/athletes/"+e(t(this.event.athlete.id))+"'>"+e(t(this.event.athlete.annotation.firstName+" "+this.event.athlete.annotation.lastName))+"</a>\n  <span class='action'>commented on</span>"),this.event.athlete.id===this.event.activity.athlete.id?(n.push("  <span>"),n.push("F"===this.event.athlete.annotation.sex?"    her":"    his"),n.push("  </span>")):n.push("  <a class='athlete' href='/athletes/"+e(t(this.event.activity.athlete.id))+"'>"+e(i)+"'s</a>"),n.push("  <span>"+this.event.activity.annotation.activityType+":</span>\n  <a class='activity' href='/activities/"+e(t(this.event.activity.id))+"'>"+e(t(this.event.activity.annotation.title))+"</a>\n  <span class='comment'>"),n.push("    "+t(r("&ldquo;","&rdquo;",function(){var n;return n=[],n.push("    "+e(t(this.event.annotation.message))),n.join("\n")}))),n.push("  </span>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["minifeed/photo_entry"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<a class='avatar avatar-athlete avatar-default'>\n  <img src='"+e(t(this.avatar))+"'>\n</a>\n<div class='content'>\n  <a class='entry-athlete' href='/athletes/"+e(t(this.event.athlete.id))+"'>"+e(t(this.event.athlete.annotation.firstName+" "+this.event.athlete.annotation.lastName))+"</a>\n  <span class='action'>posted a photo</span>\n  <a href='"+e(t(this.event.ref))+"' target='_blank'>\n    <img class='thumbnail' src='"+e(t(this.event.ref))+"media/?size=t' alt='"+e(t(this.event.caption))+"'>\n  </a>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["minifeed/kudo_entry"]=function(t){return function(){var t,e,n,i;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],i=this.event.activity.athlete.annotation.firstName+" "+this.event.activity.athlete.annotation.lastName,n.push("<a class='avatar avatar-athlete avatar-default'>\n  <img src='"+e(t(this.avatar))+"'>\n</a>\n<div class='content'>\n  <a class='entry-athlete' href='/athletes/"+e(t(this.event.athlete.id))+"'>"+e(t(this.event.athlete.annotation.firstName+" "+this.event.athlete.annotation.lastName))+"</a>\n  <span class='action'>kudoed</span>\n  <a class='athlete' href='/athletes/"+e(t(this.event.activity.athlete.id))+"'>"+e(i)+"'s</a>\n  <span>"+this.event.activity.annotation.activityType+":</span>\n  <a class='activity' href='/activities/"+e(t(this.event.activity.id))+"'>"+e(t(this.event.activity.annotation.title))+"</a>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["minifeed/activity_entry"]=function(t){return function(){var t,e,n,i;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],i=this.event.activity.athlete.annotation.firstName+" "+this.event.activity.athlete.annotation.lastName,n.push("<a class='avatar avatar-athlete avatar-default'>\n  <img src='"+e(t(this.avatar))+"'>\n</a>\n<div class='content'>\n  <a class='entry-athlete' href='/athletes/"+e(t(this.event.activity.athlete.id))+"'>"+e(t(i))+"</a>\n  <span class='action'>uploaded a new "+this.event.activity.annotation.activityType+":</span>\n  <a class='activity' href='/activities/"+e(t(this.event.activity.id))+"'>"+e(t(this.event.activity.annotation.title))+"</a>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.MiniFeedEntryView=function(e){function n(t,e){this.eventType=t,this.template="minifeed/"+t+"_entry",this.event=e,this.popover=this.$$("#strava-minifeed .popover"),n.__super__.constructor.call(this)}return t(n,e),n.prototype.tagName="li",n.prototype.className="entry",n.prototype.events={"mouseover .thumbnail":"previewPhoto","mouseleave .thumbnail":"hidePreviewPhoto"},n.prototype.render=function(){return this.renderTemplate({event:this.event,avatar:this.getAvatarUrl(this.event)}),this.$el.data("event",this.eventType),this.$el.addClass(this.eventType),this
},n.prototype.getAvatarUrl=function(t){var e,n;return e=null!=t.athlete?t.athlete:t.activity.athlete,n=["https://www.strava.com","athletes",e.id,"avatar?size=medium"],n.join("/")},n.prototype.previewPhoto=function(){var t,e,n,i;return t=this.$el.offset(),e=this.$(".thumbnail"),i=e.attr("src"),n=e.attr("alt"),this.popover.html("<img src='"+i+"' /><div class='caption'>"+n+"</div>").css({top:t.top}).show()},n.prototype.hidePreviewPhoto=function(){return this.popover.html("").hide()},n}(Backbone.View)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["minifeed/index"]=function(t){return function(){var t;return t=[],t.push("<header>\n  <h2>Minifeed</h2>\n  <span class='toggle-minifeed' title='Toggle minifeed window'>Toggle Minifeed window</span>\n</header>\n<div class='minifeed'>\n  <ul></ul>\n</div>\n<div class='popover'></div>"),t.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.MiniFeedView=function(e){function n(){this.template="minifeed/index",this.isOpen=!1}return t(n,e),n.prototype.render=function(){return Modernizr.localstorage&&"false"===localStorage.getItem("minifeed_minimized")&&this.open(),this.renderTemplate(),this.prepareMinifeedToggle()},n.prototype.addEntry=function(t){return this.entryValid(t)?(t=new Strava.Feed.MiniFeedEntryView(t.eventType,t.event),this.$el.find("ul").prepend(t.render().el),t.$el.hide().slideDown(300)):void 0},n.prototype.prepareMinifeedToggle=function(){return this.$$("#strava-minifeed header").on("click",function(t){return function(){return t.isOpen?t.close():t.open()}}(this))},n.prototype.open=function(){var t;return t=this.$$("html"),t.addClass("minifeed-open"),this.trigger("open"),this.updateMinifeedVisibility(!1),this.isOpen=!0},n.prototype.close=function(){var t;return t=this.$$("html"),t.removeClass("minifeed-open"),this.trigger("close"),this.updateMinifeedVisibility(!0),this.isOpen=!1},n.prototype.updateMinifeedVisibility=function(t){return null==t&&(t=!0),Modernizr.localstorage?localStorage.setItem("minifeed_minimized",t):void 0},n.prototype.entryValid=function(t){return null!=t.event&&null!=t.event.activity},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PageVisibilityTracker=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.send=function(t,e){if("event"===t){if("visible"===e.eventLabel)return this.trigger("pageEnter");if("hidden"===e.eventLabel)return this.trigger("pageExit")}},n.configure=function(){var t;return t=new this,Strava.Util.Autotrack.configurePageVisibilityTracker(t)},n}(Backbone.Model)}.call(this),function(){null==window.JST&&(window.JST={}),window.JST["feed/lightbox"]=function(t){return function(){var t,e,n;return e=window.HAML.escape,t=window.HAML.cleanValue,n=[],n.push("<header class='modal-header'>\n  <div class='avatar avatar-athlete avatar-sm mr-sm pull-left'>\n    <img class='avatar-img' src='"+e(t(this.data.athlete_avatar))+"' alt='"+e(t(this.data.athlete_name))+"' title='"+e(t(this.data.athlete_name))+"'>\n  </div>\n  <h3 class='lightbox-title'>"+e(t(this.data.title))+"</h3>\n</header>\n<ul class='bottomless tabs topless' id='lightbox-tabs'>\n  <li id='kudos'>\n    <a class='tab'>"),n.push("      "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.kudos")))),n.push("      <span class='kudo_text' data-current-count='"+e(t(this.data.kudo_count))+"'>"+e(t(this.data.kudo_text))+"</span>\n    </a>\n  </li>\n  <li id='comments'>\n    <a class='tab'>"),n.push("      "+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.comments")))),n.push("      <span class='comment_text'>"+e(t(this.data.comment_text))+"</span>\n    </a>\n  </li>\n  <li id='achievements' style='display: none'>\n    <a class='tab'>"+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.achievements",{achievements_count:this.data.achievements_count})))+"</a>\n  </li>\n  <li id='group-athletes' style='display: none'>\n    <a class='tab'>"+e(t(Strava.I18n.Locale.t("templates.feed.lightbox.other_athletes")))+"</a>\n  </li>\n</ul>\n<div class='modal-body' id='tab-contents'>\n  <div class='centerAlign'>\n    <div class='sm spinner'>\n      <div class='graphic'></div>\n      <span class='status'></span>\n    </div>\n  </div>\n</div>"),n.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(t))}}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PopoverBoxView=function(e){function n(t,e,i,r){this.template="feed/lightbox",this.lightbox=new Strava.Ui.LightboxView,this.commentsController=t,this.kudosController=e,this.achievementsController=i,this.groupRideController=r,this.commentsController.bind("commentCreated",function(t){return function(e,n){return t.updateCommentCount(n)}}(this)).bind("commentDeleted",function(t){return function(e){return t.updateCommentCount(e)}}(this)),this.kudosController.bind("kudoCreated",function(t){return function(){return t.updateKudoCount()}}(this)),n.__super__.constructor.call(this)}var i,r;return t(n,e),i={},r={},n.prototype.render=function(t,e,n,i,r,o,a,s){return null==a&&(a=!0),this.setElement("<div></div>"),this.renderTemplate(this.getModelJson(t,e,n)),this.lightbox.render(this.el),this.createTabs(t,e,i,r,o,a,s),this},n.prototype.getModelJson=function(t,e,n){var i;return i=t+"-"+e,n.comment_text=this.getCommentTabText(i,n),n.kudo_count||(n.kudo_count=this.getDOMKudoCount(i)),n.kudo_text=n.kudo_count>0?"("+n.kudo_count+")":"",this.achievementsController&&!n.achievements_count&&(n.achievements_count=this.achievementsController.getFromHash(i).length),{data:n}},n.prototype.getCommentTabText=function(t,e){var n;return null==e&&(e={}),n=e.comment_count||this.commentsController.getFromHash(t).length,n>0?"("+n+")":""},n.prototype.getDOMKudoCount=function(t){return this.$$(".feed #"+t+" .count-kudos").data("kudo-count")},n.prototype.updateKudoCount=function(){var t,e;return t=this.$(".kudo_text"),e=parseInt(t.data("current-count")||0,10),t.html("("+(e+1)+")")},n.prototype.updateCommentCount=function(t){var e;return e=this.getCommentTabText(t),this.$("span.comment_text").html(e)},n.prototype.createTabs=function(t,e,n,i,r,o,a){var s,c,l,u,h,d;return null==o&&(o=!0),c=u=s=l=!1,"comments"===n?c=!0:"kudos"===n?u=!0:"achievements"===n?s=!0:l=!0,d=[],d.push({selector:"li#comments",renderer:this.commentBoxView(t,e),selected:c}),o?(d.push({selector:"li#kudos",renderer:this.kudoBoxView(t,e),selected:u}),this.$("li#kudos").show()):this.$("li#kudos").hide(),i&&(d.push({selector:"li#achievements",renderer:new Strava.Feed.AchievementsView(this.achievementsController,t,e),selected:s}),this.$("li#achievements").show()),r&&(d.push({selector:"li#group-athletes",renderer:new Strava.Feed.GroupRideView(this.groupRideController,t,e,a),selected:l}),this.$("li#group-athletes").show()),h=new Strava.Ui.TabController(d,"#lightbox-tabs"),h.render()},n.prototype.commentBoxView=function(t,e){var n;return n=t+"-"+e,i[n]||(i[n]=new Strava.Feed.CommentBoxView(this.commentsController,t,e)),i[n]},n.prototype.kudoBoxView=function(t,e){var n;return n=t+"-"+e,r[n]||(r[n]=new Strava.Feed.KudoBoxView(this.kudosController,t,e)),r[n]},n.show=function(t,e,n,i,r,o,a){return null==i&&(i="comments"),null==r&&(r=!1),null==o&&(o=!1),this.instance.render(t,e,n,i,r,o,!0,a)},n.createInstance=function(t,e,n,i){return this.instance=new Strava.Feed.PopoverBoxView(t,e,n,i)},n}(Backbone.View),Strava.Feed.PopoverBoxActivityView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.getDOMKudoCount=function(){return this.$$("#kudos .count").data("count")},n.createInstance=function(t,e,n,i){return this.instance=new Strava.Feed.PopoverBoxActivityView(t,e,n,i)},n}(Strava.Feed.PopoverBoxView),Strava.Feed.PopoverBoxPostView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.createInstance=function(t,e){return this.instance=new Strava.Feed.PopoverBoxPostView(t,e,null,null)},n.show=function(t,e,n,i,r){return null==i&&(i="comments"),null==r&&(r=!0),this.instance.render(t,e,n,i,!1,!1,r)},n}(Strava.Feed.PopoverBoxView)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.PrimaryPhotoFeedView=function(e){function n(t,e,i,r,o){this.el=t,this.activityId=e,this.polyline=i,this.primaryPhotoUrl=r,this.displayMap=null!=o?o:!0,n.__super__.constructor.call(this)}return t(n,e),n.prototype.render=function(){return this.$(".activity-primary-photo-container").css("background-image","url("+this.primaryPhotoUrl+")"),this.displayMap&&new Strava.Maps.PolylineOverlay(this.activityId,this.polyline,15,{}),this.$(".leaflet-zoom-animated").css({"-webkit-transform":"translate3d(0,0,0)"})},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Feed"),Strava.Feed.SlotsView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(t){return this.remaining=t.remaining,this.$el.find("li.media .card-entry-item").each(function(e){return function(n,i){var r;return r=new Strava.Feed.CardEntryItemView({model:t.slotted.at(n)}),r.attachToDom(i),e.addCardDismissHandler(n,r)}}(this))},n.prototype.addCardDismissHandler=function(t,e){return e.on("cardEntryItem:dismiss",function(n){return function(){return n.handleCardDismiss(t,e)}}(this))},n.prototype.renderCardAtIndex=function(t){var e,n;return n=this.remaining.shift(),n?(e=new Strava.Feed.CardEntryItemView({model:n}),this.addCardDismissHandler(t,e),e.$el.hide(),this.$("li.media").eq(t).append(e.render().el),e.$el.fadeIn(200)):this.$("li.media").eq(t).hide()},n.prototype.handleCardDismiss=function(t,e){return e.$el.fadeOut(200,function(n){return function(){return e.hide(),n.renderCardAtIndex(t),n.$("li.media").size()===n.$("li.media").filter(":hidden").size()?(n.$el.closest(".card-entry").find(".no-content").fadeIn(200),n.$el.closest(".card-entry").find("ul.list-media").hide()):void 0}}(this))},n}(Backbone.View)}.call(this),function(){Strava.module("Strava.Feed.Ui"),Strava.Feed.Ui=function(){function t(){}return t.commentsController=null,t.achievementsController=null,t.prepareUi=function(){return Strava.Feed.Ui.prepareCommentButton(),Strava.Ui.Global.prepareAutoresizingTextbox(),Strava.Feed.Ui.prepareExpandableAthletesList(),Strava.Feed.Ui.prepareExpandCommentsButton(),this.commentsController=new Strava.Lib.CommentsController,this.achievementsController=new Strava.Lib.AchievementsController},t.prepareCommentButton=function(){return jQuery("body").on("click",".js-inline-comments .add-comment, .btn-comment",function(){var t;return t=jQuery(this).parents(".feed-entry"),t.find(".social").removeClass("has-border"),t.find(".comments form").show().find("textarea").focus()})},t.prepareExpandableAthletesList=function(){return jQuery("body").on("click",".group-entry .expand-all",function(){return jQuery(this).hide(),jQuery(this).prev().find("li.hidden").removeClass("hidden"),jQuery(this).prev().find("li.last-child").removeClass("last-child")})},t.prepareExpandCommentsButton=function(){return jQuery("body").on("click",".comments .expand-all",function(){return jQuery(this).hide().next().find("li:not(:visible)").show()})},t}()}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Ui"),Strava.Ui.TabController=function(e){function n(t,e,i){null==e&&(e="ul.tabs"),null==i&&(i="#tab-contents"),this.el=e,this.tabs=t||[],this.contentSelector=i,this.bindToTabs(),n.__super__.constructor.call(this),this.tabClickHandler(function(t,e){return e.renderer.selected?void 0:t.showTab(e)})}return t(n,e),n.prototype.render=function(){var t;return t=_.find(this.tabs,function(t){return t.selected}),this.showTab(t)},n.prototype.unselectTabs=function(){var t,e,n,i,r;for(n=this.tabs,i=[],t=0,e=n.length;e>t;t++)r=n[t],r.renderer.unselect(),i.push(this.$(r.selector).removeClass("selected"));return i},n.prototype.selectTab=function(t){return t.renderer.select(),t.renderer.render(this.contentSelector),t.renderer.show(),this.$(t.selector).addClass("selected")},n.prototype.showTab=function(t){return this.unselectTabs(),this.selectTab(t)},n.prototype.tabClickHandler=function(t){return this.setOrGet("_tabClickHandler",t)},n.prototype.addTab=function(t,e,n){var i;return null==n&&(n=!1),i={selector:t,renderer:e,selected:n},this.tabs.push(i),e.on("close",function(t){return function(){return t.trigger("close")}}(this)),e.on("actionSuccess",function(t){return function(e){return t.trigger("actionSuccess",e)}}(this)),e.on("actionError",function(t){return function(e){return t.trigger("actionError",e)}}(this)),this.$(t).on("click",function(t){return function(){return t.tabClickHandler()(t,i)}}(this))},n.prototype.bindToTabs=function(){return jQuery.each(this.tabs,function(t){return function(e,n){return jQuery(n.selector).bind("click",function(){return t.tabClickHandler()(t,n)})}}(this))},n}(Backbone.View)}.call(this),function(t,e){var e=e;e.templateSettings.escape=/<%-([\s\S]+?)%>/g;var n={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35},i={triggerChar:"@",onDataRequest:t.noop,minChars:2,showAvatars:!0,elastic:!0,classes:{autoCompleteItemActive:"active"},templates:{wrapper:e.template('<div class="mentions-input-box"></div>'),autocompleteList:e.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:e.template('<li data-ref-id="{{ id }}" data-ref-type="{{ type }}" data-display="{{ display }}">{- content -}</li>'),autocompleteListItemAvatar:e.template('<img src="{{ avatar }}" />'),autocompleteListItemIcon:e.template('<div class="icon {{ icon }}"></div>'),mentionsOverlay:e.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:e.template("[{{ value }}](athlete:{{ id }})"),mentionItemHighlight:e.template('<span><strong><a href="/athletes/{{ id }}">{{ value }}</a></strong></span>')}},r={htmlEncode:function(t){return e.escape(t)},highlightTerm:function(t,e){return e||e.length?t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"):t},setCaratPosition:function(t,e){if(t.createTextRange){var n=t.createTextRange();n.move("character",e),n.select()}else t.selectionStart?(t.focus(),t.setSelectionRange(e,e)):t.focus()},rtrim:function(t){return t.replace(/\s+$/,"")}},o=function(o){function a(){E=t(C),"true"!=E.attr("data-mentions-input")&&(A=E.parent(),x=t(o.templates.wrapper()),E.wrapAll(x),x=A.find("> div"),E.attr("data-mentions-input","true"),E.bind("keydown",b),E.bind("keypress",g),E.bind("input",y),E.bind("click",f),E.bind("blur",v))}function s(){I=t(o.templates.autocompleteList()),I.appendTo(x),I.delegate("li","mousedown",m)}function c(){L=t(o.templates.mentionsOverlay()),L.prependTo(x)}function l(){var t=p();e.each(F,function(e){var n=o.templates.mentionItemSyntax(e);t=t.replace(e.value,n)});var n=r.htmlEncode(t);e.each(F,function(t){var i=e.extend({},t,{id:t.id,value:r.htmlEncode(t.value)}),a=o.templates.mentionItemSyntax(i),s=o.templates.mentionItemHighlight(i);n=n.replace(a,s)}),n=n.replace(/\n/g,"<br />"),n=n.replace(/ {2}/g,"&nbsp; "),E.data("messageText",t),L.find("div").html(n)}function u(){$=[]}function h(){var t=p();F=e.reject(F,function(e){return!e.value||-1==t.indexOf(e.value.replace("",""))}),F=e.compact(F)}function d(t){var e=p(),n=new RegExp("\\"+o.triggerChar+M,"gi");n.exec(e);var i=n.lastIndex-M.length-1,a=n.lastIndex,s=e.substr(0,i),c=e.substr(a,e.length),h=(s+t.value).length+1;F.push(t),u(),M="",w(),t.value="@"+t.value;var d=s+""+t.value+" "+c;E.val(d),l(),E.focus(),r.setCaratPosition(E[0],h)}function p(){return t.trim(E.val())}function m(){var e=t(this),n=j[e.attr("data-uid")];return d(n),!1}function f(){u()}function v(){w()}function y(){l(),h();var t=e.lastIndexOf($,o.triggerChar);t>-1&&(M=$.slice(t+1).join(""),M=r.rtrim(M),e.defer(e.bind(S,this,M)))}function g(t){if(t.keyCode!==n.BACKSPACE){var e=String.fromCharCode(t.which||t.keyCode);$.push(e)}}function b(i){if(i.keyCode==n.LEFT||i.keyCode==n.RIGHT||i.keyCode==n.HOME||i.keyCode==n.END)return e.defer(u),void(navigator.userAgent.indexOf("MSIE 9")>-1&&e.defer(l));if(i.keyCode==n.BACKSPACE)return void($=$.slice(0,-1+$.length));if(!I.is(":visible"))return!0;switch(i.keyCode){case n.UP:case n.DOWN:var r=null;return r=i.keyCode==n.DOWN?O&&O.length?O.next():I.find("li").first():t(O).prev(),r.length&&_(r),!1;case n.RETURN:case n.TAB:if(O&&O.length)return O.trigger("mousedown"),!1}return!0}function w(){O=null,I.empty().hide()}function _(t){t.addClass(o.classes.autoCompleteItemActive),t.siblings().removeClass(o.classes.autoCompleteItemActive),O=t}function k(n,i){I.show();var a=e.pluck(F,"value");if(i=e.reject(i,function(t){return e.include(a,t.name)||e.include(a,"@"+t.name)}),!i.length)return void w();I.empty();var s=t("<ul>").appendTo(I).hide();e.each(i,function(i,a){var c=e.uniqueId("mention_");j[c]=e.extend({},i,{value:i.name});var l=t(o.templates.autocompleteListItem({id:r.htmlEncode(i.id),display:r.htmlEncode(i.name),type:r.htmlEncode(i.type),content:r.highlightTerm(r.htmlEncode(i.name),n)})).attr("data-uid",c);if(0===a&&_(l),o.showAvatars){var u;u=t(i.avatar?o.templates.autocompleteListItemAvatar({avatar:i.avatar}):o.templates.autocompleteListItemIcon({icon:i.icon})),u.prependTo(l)}l=l.appendTo(s)}),I.show(),s.show()}function S(t){t&&t.length&&t.length>=o.minChars?o.onDataRequest.call(this,"search",t,function(e){k(t,e)}):w()}function T(){E.val(""),F=[],l()}var C,E,A,I,x,L,O,M,F=[],j={},$=[];return o=t.extend(!0,{},i,o),{init:function(t){C=t,a(),s(),c(),T(),o.prefillMention&&d(o.prefillMention)},val:function(t){if(e.isFunction(t)){var n=F.length?E.data("messageText"):p();t.call(this,n)}},reset:function(){T()},getMentions:function(t){e.isFunction(t)&&t.call(this,F)}}};t.fn.mentionsInput=function(n,i){var r=arguments;return"object"!=typeof n&&n||(i=n),this.each(function(){var a=t.data(this,"mentionsInput")||t.data(this,"mentionsInput",new o(i));return e.isFunction(a[n])?a[n].apply(this,Array.prototype.slice.call(r,1)):"object"!=typeof n&&n?void t.error("Method "+n+" does not exist"):a.init.call(this,this)})}}(jQuery,_),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntryAction=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.label=function(){return this._action().text},n.prototype.actionState=function(){return"initial"===this.get("state")?"on":"off"},n.prototype.trackableTargetUrl=function(){return this._action().trackable_target_url},n.prototype.execute=function(){var t;return t={url:this._action().url,type:this._action().method},null!=this._hasData()&&(t.data=this._action().data),jQuery.ajax(t).done(function(t){return function(){return t._hasNext()?t._next():void 0}}(this))},n.prototype._action=function(){return this._getActionByState(this.get("state"))},n.prototype._getActionByState=function(t){return this._hasState(t)?this.get(t):null},n.prototype._hasData=function(){return this._action().hasOwnProperty("data")},n.prototype._hasState=function(t){return!!this.get(t)},n.prototype._hasNext=function(){switch(this.get("state")){case"initial":return this._hasState("completed")?!0:!1;case"completed":return this._hasState("initial")?!0:!1;default:return!1}},n.prototype._next=function(){switch(this.get("state")){case"initial":return this.set({state:"completed"});case"completed":return this.set({state:"initial"});default:return null}},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntryActions=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Strava.Models.CardEntryAction,n.prototype.hasActions=function(){return this.length>0},n}(Backbone.Collection)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.CardEntry=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.actionCollection=new Strava.Models.CardEntryActions(this.get("actions")),this.hasDismissAction()?this.dismiss=new Strava.Models.CardEntryAction(this.get("dismiss_action")):void 0},n.prototype.title=function(){return this.get("title")},n.prototype.subtitle=function(){return this.get("subtitle")},n.prototype.destinationUrl=function(){return this.get("destination_url")},n.prototype.avatarUrl=function(){return this.get("avatar").url},n.prototype.avatarShape=function(){return this.get("avatar").mask_shape},n.prototype.hasDismissAction=function(){return!!this.get("dismiss_action")},n.prototype.dismissAction=function(){return this.hasDismissAction()?this.dismiss:null},n.prototype.actions=function(){return this.actionCollection},n.prototype.avatar=function(){return this.avatarDeferred?this.avatarDeferred:(this.avatarDeferred=jQuery.Deferred(),this.avatar=new Image,this.avatar.src=this.avatarUrl(),this.avatar.alt=this.title(),this.avatar.onload=function(t){return function(){return t.avatarDeferred.resolve(t,t.avatar)}}(this),this.avatar.onerror=function(t){return function(){return t.avatarDeferred.reject(t,t.avatar)}}(this),this.avatarDeferred)},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t},e={}.hasOwnProperty;Strava.module("Strava.Models"),Strava.Models.Cards=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=Strava.Models.CardEntry,n}(Backbone.Collection)}.call(this);