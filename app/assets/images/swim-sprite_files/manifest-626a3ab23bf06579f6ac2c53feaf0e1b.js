(function(){var o=function(o,n){function i(){this.constructor=o}for(var r in n)t.call(n,r)&&(o[r]=n[r]);return i.prototype=n.prototype,o.prototype=new i,o.__super__=n.prototype,o},t={}.hasOwnProperty;Strava.module("Strava.Notifications.DropDown"),Strava.Notifications.DropDown.MarkAllReadController=function(t){function n(o){this.url=o,n.__super__.constructor.call(this)}return o(n,t),n.prototype.markAllNotificationsRead=function(){return this.fetch({type:"POST",contentType:"application/json",success:function(o){return function(){return o.trigger("all_notifications_marked_read")}}(this)})},n}(Backbone.Model)}).call(this),function(){var o=function(o,n){function i(){this.constructor=o}for(var r in n)t.call(n,r)&&(o[r]=n[r]);return i.prototype=n.prototype,o.prototype=new i,o.__super__=n.prototype,o},t={}.hasOwnProperty;Strava.module("Strava.Notifications.DropDown"),Strava.Notifications.DropDown.View=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return o(n,t),n.prototype.el=".nav-bar",n.prototype.events={"click #notifications-button":"handleClickNotificationsCount","mouseenter #notifications-drop-down":"handleMouseEnterDropDown","mouseleave #notifications-drop-down":"handleMouseLeaveDropDown"},n.prototype.initialize=function(o){return this.controller=o,this.controller.bind("all_notifications_marked_read",function(o){return function(){return o.handleAllNotificationsMarkedRead()}}(this)),this.lockTo=jQuery(window).scrollTop(),jQuery(document).click(function(o){return function(){var t;return o.$("#notifications-drop-down").is(":visible")&&(t=event.target.closest("#notifications-drop-down")&&(event.metaKey||event.ctrlKey),!t)?o.hideDropDown():void 0}}(this)),n.__super__.initialize.call(this)},n.prototype.handleAllNotificationsMarkedRead=function(){return this.$("#notifications-count").text("0"),this.$("#notifications-button").addClass("empty").prop("title",Strava.I18n.Locale.t("strava.notifications.drop_down.view.zero_notifications"))},n.prototype.handleClickNotificationsCount=function(o){return o.stopPropagation(),this.$("#notifications-drop-down").is(":visible")?this.hideDropDown():this.showDropDown()},n.prototype.showDropDown=function(){return this.$(".no-avatar").each(function(){var o;return o=jQuery(this),o.attr("src",o.data("src")).removeClass("no-avatar").addClass("avatar")}),this.$("#notifications-button").addClass("active"),this.$("#notifications-drop-down").slideDown(100),this.$("#notifications-content").scrollTop(0),this.controller.markAllNotificationsRead()},n.prototype.hideDropDown=function(){return this.$("#notifications-button").removeClass("active"),this.$("#notifications-drop-down").slideUp(100)},n.prototype.handleMouseEnterDropDown=function(){return this.lockTo=jQuery(window).scrollTop(),jQuery(window).on("scroll.notifications",function(o){return function(){return jQuery("html").addClass("no-scrolling"),jQuery(window).scrollTop(o.lockTo)}}(this))},n.prototype.handleMouseLeaveDropDown=function(){return jQuery("html").removeClass("no-scrolling"),jQuery(window).off("scroll.notifications")},n}(Backbone.View)}.call(this);